{"version":3,"sources":["map.plugins.js"],"names":["InfoBox","opt_opts","google","maps","OverlayView","apply","this","arguments","content_","content","disableAutoPan_","disableAutoPan","maxWidth_","maxWidth","pixelOffset_","pixelOffset","Size","position_","position","LatLng","zIndex_","zIndex","boxClass_","boxClass","boxStyle_","boxStyle","closeBoxMargin_","closeBoxMargin","closeBoxURL_","closeBoxURL","closeBoxTitle_","closeBoxTitle","infoBoxClearance_","infoBoxClearance","visible","isHidden","isHidden_","alignBottom_","alignBottom","pane_","pane","enableEventPropagation_","enableEventPropagation","div_","closeListener_","moveListener_","contextListener_","eventListeners_","fixedWidthSet_","MarkerClusterer","map","opt_markers","opt_options","extend","map_","markers_","clusters_","sizes","styles_","ready_","options","gridSize_","minClusterSize_","maxZoom_","imagePath_","MARKER_CLUSTER_IMAGE_PATH_","imageExtension_","MARKER_CLUSTER_IMAGE_EXTENSION_","zoomOnClick_","undefined","averageCenter_","setupStyles_","setMap","prevZoom_","getZoom","that","event","addListener","zoom","resetViewport","redraw","length","addMarkers","Cluster","markerClusterer","markerClusterer_","getMap","getGridSize","getMinClusterSize","isAverageCenter","center_","bounds_","clusterIcon_","ClusterIcon","getStyles","cluster","styles","opt_padding","getMarkerClusterer","padding_","cluster_","sums_","visible_","prototype","createInfoBoxDiv_","i","events","bw","me","cancelHandler","e","cancelBubble","stopPropagation","document","createElement","setBoxStyle_","nodeType","innerHTML","getCloseBoxImg_","appendChild","getPanes","addClickHandler_","style","width","offsetWidth","overflow","getBoxWidths_","left","right","panBox_","push","addDomListener","cursor","returnValue","preventDefault","trigger","img","closeBox","firstChild","getCloseClickHandler_","close","disablePan","xOffset","yOffset","Map","getBounds","contains","setCenter","iwOffsetX","iwOffsetY","height","iwWidth","iwHeight","offsetHeight","padX","padY","panToBounds","padding","top","bottom","LatLngBounds","mapDiv","getDiv","mapWidth","mapHeight","pixPosition","getProjection","fromLatLngToContainerPixel","x","y","getCenter","panBy","className","cssText","hasOwnProperty","WebkitTransform","indexOf","opacity","MsFilter","filter","visibility","computedStyle","box","defaultView","getComputedStyle","ownerDocument","parseInt","borderTopWidth","borderBottomWidth","borderLeftWidth","borderRightWidth","documentElement","currentStyle","onRemove","parentNode","removeChild","draw","fromLatLngToDivPixel","setOptions","setContent","setPosition","setZIndex","removeListener","latlng","index","setVisible","isVisible","getContent","getPosition","getZIndex","getVisible","getWidth","getHeight","show","hide","open","anchor","obj1","obj2","object","property","onAdd","setReady_","size","url","fitMapToMarkers","marker","markers","getMarkers","bounds","fitBounds","setStyles","isZoomOnClick","getTotalMarkers","setMaxZoom","maxZoom","getMaxZoom","calculator_","numStyles","count","dv","text","Math","min","setCalculator","calculator","getCalculator","opt_nodraw","pushMarkerTo_","isAdded","repaint","addMarker","removeMarker_","m","splice","removeMarker","removed","removeMarkers","r","ready","createClusters_","getTotalClusters","setGridSize","setMinClusterSize","getExtendedBounds","projection","tr","getNorthEast","lat","lng","bl","getSouthWest","trPix","blPix","ne","fromDivPixelToLatLng","sw","isMarkerInBounds_","clearMarkers","opt_hide","remove","oldClusters","slice","window","setTimeout","distanceBetweenPoints_","p1","p2","dLat","PI","dLon","a","sin","cos","atan2","sqrt","addToClosestCluster_","distance","clusterToAddTo","center","d","isMarkerInClusterBounds","mapBounds","isMarkerAlreadyAdded","l","calculateBounds_","len","updateIcon","getSize","mz","sums","setSums","triggerClusterClick","pos","getPosFromLatLng_","createCss","overlayMouseTarget","isDragging","iconAnchor_","width_","height_","display","text_","index_","useStyle","max","url_","textColor_","anchor_","textSize_","backgroundPosition_","backgroundPosition","txtColor","txtSize","join"],"mappings":"AA6EA,SAASA,QAAQC,GAEfA,EAAWA,GAAY,GAEvBC,OAAOC,KAAKC,YAAYC,MAAMC,KAAMC,WAIpCD,KAAKE,SAAWP,EAASQ,SAAW,GACpCH,KAAKI,gBAAkBT,EAASU,iBAAkB,EAClDL,KAAKM,UAAYX,EAASY,UAAY,EACtCP,KAAKQ,aAAeb,EAASc,aAAe,IAAIb,OAAOC,KAAKa,KAAK,EAAG,GACpEV,KAAKW,UAAYhB,EAASiB,UAAY,IAAIhB,OAAOC,KAAKgB,OAAO,EAAG,GAChEb,KAAKc,QAAUnB,EAASoB,QAAU,KAIlCf,KAAKgB,UAAYrB,EAASsB,UAAY,UACtCjB,KAAKkB,UAAYvB,EAASwB,UAAY,GACtCnB,KAAKoB,gBAAkBzB,EAAS0B,gBAAkB,MAClDrB,KAAKsB,aAAe3B,EAAS4B,aAAe,iDACf,KAAzB5B,EAAS4B,cACXvB,KAAKsB,aAAe,IAEtBtB,KAAKwB,eAAiB7B,EAAS8B,eAAiB,UAChDzB,KAAK0B,kBAAoB/B,EAASgC,kBAAoB,IAAI/B,OAAOC,KAAKa,KAAK,EAAG,QAE9C,IAArBf,EAASiC,eACe,IAAtBjC,EAASkC,SAClBlC,EAASiC,SAAU,EAEnBjC,EAASiC,SAAWjC,EAASkC,UAGjC7B,KAAK8B,WAAanC,EAASiC,QAE3B5B,KAAK+B,aAAepC,EAASqC,cAAe,EAC5ChC,KAAKiC,MAAQtC,EAASuC,MAAQ,YAC9BlC,KAAKmC,wBAA0BxC,EAASyC,yBAA0B,EAElEpC,KAAKqC,KAAO,KACZrC,KAAKsC,eAAiB,KACtBtC,KAAKuC,cAAgB,KACrBvC,KAAKwC,iBAAmB,KACxBxC,KAAKyC,gBAAkB,KACvBzC,KAAK0C,eAAiB,KAmzBxB,SAASC,gBAAgBC,EAAKC,EAAaC,GAMzC9C,KAAK+C,OAAOJ,gBAAiB/C,OAAOC,KAAKC,aACzCE,KAAKgD,KAAOJ,EAMZ5C,KAAKiD,SAAW,GAKhBjD,KAAKkD,UAAY,GAEjBlD,KAAKmD,MAAQ,CAAC,GAAI,GAAI,GAAI,GAAI,IAK9BnD,KAAKoD,QAAU,GAMfpD,KAAKqD,QAAS,EAEd,IAAIC,EAAUR,GAAe,GAM7B9C,KAAKuD,UAAYD,EAAkB,UAAK,GAKxCtD,KAAKwD,gBAAkBF,EAA4B,oBAAK,EAOxDtD,KAAKyD,SAAWH,EAAiB,SAAK,KAEtCtD,KAAKoD,QAAUE,EAAgB,QAAK,GAMpCtD,KAAK0D,WAAaJ,EAAmB,WACjCtD,KAAK2D,2BAMT3D,KAAK4D,gBAAkBN,EAAwB,gBAC3CtD,KAAK6D,gCAMT7D,KAAK8D,cAAe,EAEUC,MAA1BT,EAAqB,cACvBtD,KAAK8D,aAAeR,EAAqB,aAO3CtD,KAAKgE,gBAAiB,EAEUD,MAA5BT,EAAuB,gBACzBtD,KAAKgE,eAAiBV,EAAuB,eAG/CtD,KAAKiE,eAELjE,KAAKkE,OAAOtB,GAMZ5C,KAAKmE,UAAYnE,KAAKgD,KAAKoB,UAG3B,IAAIC,EAAOrE,KACXJ,OAAOC,KAAKyE,MAAMC,YAAYvE,KAAKgD,KAAM,eAAgB,WACvD,IAAIwB,EAAOH,EAAKrB,KAAKoB,UAEjBC,EAAKF,WAAaK,IACpBH,EAAKF,UAAYK,EACjBH,EAAKI,mBAIT7E,OAAOC,KAAKyE,MAAMC,YAAYvE,KAAKgD,KAAM,OAAQ,WAC/CqB,EAAKK,WAIH7B,GAAeA,EAAY8B,QAC7B3E,KAAK4E,WAAW/B,GAAa,GA6mBjC,SAASgC,QAAQC,GACf9E,KAAK+E,iBAAmBD,EACxB9E,KAAKgD,KAAO8B,EAAgBE,SAC5BhF,KAAKuD,UAAYuB,EAAgBG,cACjCjF,KAAKwD,gBAAkBsB,EAAgBI,oBACvClF,KAAKgE,eAAiBc,EAAgBK,kBACtCnF,KAAKoF,QAAU,KACfpF,KAAKiD,SAAW,GAChBjD,KAAKqF,QAAU,KACfrF,KAAKsF,aAAe,IAAIC,YAAYvF,KAAM8E,EAAgBU,YACtDV,EAAgBG,eAuNtB,SAASM,YAAYE,EAASC,EAAQC,GACpCF,EAAQG,qBAAqB7C,OAAOwC,YAAa3F,OAAOC,KAAKC,aAE7DE,KAAKoD,QAAUsC,EACf1F,KAAK6F,SAAWF,GAAe,EAC/B3F,KAAK8F,SAAWL,EAChBzF,KAAKoF,QAAU,KACfpF,KAAKgD,KAAOyC,EAAQT,SACpBhF,KAAKqC,KAAO,KACZrC,KAAK+F,MAAQ,KACb/F,KAAKgG,UAAW,EAEhBhG,KAAKkE,OAAOlE,KAAKgD,MA5vDnBtD,QAAQuG,UAAY,IAAIrG,OAAOC,KAAKC,YAMpCJ,QAAQuG,UAAUC,kBAAoB,WAEpC,IAAIC,EACAC,EACAC,EACAC,EAAKtG,KAILuG,EAAgB,SAAUC,GAC5BA,EAAEC,cAAe,EACbD,EAAEE,iBACJF,EAAEE,mBAsBN,IAAK1G,KAAKqC,KAAM,CAyCd,GAvCArC,KAAKqC,KAAOsE,SAASC,cAAc,OAEnC5G,KAAK6G,oBAEiC,IAA3B7G,KAAKE,SAAS4G,SACvB9G,KAAKqC,KAAK0E,UAAY/G,KAAKgH,kBAAoBhH,KAAKE,UAEpDF,KAAKqC,KAAK0E,UAAY/G,KAAKgH,kBAC3BhH,KAAKqC,KAAK4E,YAAYjH,KAAKE,WAI7BF,KAAKkH,WAAWlH,KAAKiC,OAAOgF,YAAYjH,KAAKqC,MAE7CrC,KAAKmH,mBAEDnH,KAAKqC,KAAK+E,MAAMC,MAElBrH,KAAK0C,gBAAiB,EAIC,IAAnB1C,KAAKM,WAAmBN,KAAKqC,KAAKiF,YAActH,KAAKM,WAEvDN,KAAKqC,KAAK+E,MAAMC,MAAQrH,KAAKM,UAC7BN,KAAKqC,KAAK+E,MAAMG,SAAW,OAC3BvH,KAAK0C,gBAAiB,IAItB2D,EAAKrG,KAAKwH,gBAEVxH,KAAKqC,KAAK+E,MAAMC,MAASrH,KAAKqC,KAAKiF,YAAcjB,EAAGoB,KAAOpB,EAAGqB,MAAS,KACvE1H,KAAK0C,gBAAiB,GAI1B1C,KAAK2H,QAAQ3H,KAAKI,kBAEbJ,KAAKmC,wBAAyB,CAUjC,IARAnC,KAAKyC,gBAAkB,GAKvB2D,EAAS,CAAC,YAAa,YAAa,WAAY,UAC9C,QAAS,WAAY,aAAc,WAAY,aAE5CD,EAAI,EAAGA,EAAIC,EAAOzB,OAAQwB,IAE7BnG,KAAKyC,gBAAgBmF,KAAKhI,OAAOC,KAAKyE,MAAMuD,eAAe7H,KAAKqC,KAAM+D,EAAOD,GAAII,IAKnFvG,KAAKyC,gBAAgBmF,KAAKhI,OAAOC,KAAKyE,MAAMuD,eAAe7H,KAAKqC,KAAM,YAAa,SAAUmE,GAC3FxG,KAAKoH,MAAMU,OAAS,aAIxB9H,KAAKwC,iBAAmB5C,OAAOC,KAAKyE,MAAMuD,eAAe7H,KAAKqC,KAAM,cA9ElD,SAAUmE,GAE5BA,EAAEuB,aAAc,EAEZvB,EAAEwB,gBAEJxB,EAAEwB,iBAGC1B,EAAGnE,yBAENoE,EAAcC,KA0EhB5G,OAAOC,KAAKyE,MAAM2D,QAAQjI,KAAM,cAQpCN,QAAQuG,UAAUe,gBAAkB,WAElC,IAAIkB,EAAM,GAeV,MAb0B,KAAtBlI,KAAKsB,eAEP4G,EAAO,OACPA,GAAO,SAAWlI,KAAKsB,aAAe,IACtC4G,GAAO,eACPA,GAAO,WAAalI,KAAKwB,eAAiB,IAC1C0G,GAAO,WACPA,GAAO,uBACPA,GAAO,oBACPA,GAAO,YAAclI,KAAKoB,gBAAkB,IAC5C8G,GAAO,MAGFA,GAOTxI,QAAQuG,UAAUkB,iBAAmB,WAEnC,IAAIgB,EAEsB,KAAtBnI,KAAKsB,cAEP6G,EAAWnI,KAAKqC,KAAK+F,WACrBpI,KAAKsC,eAAiB1C,OAAOC,KAAKyE,MAAMuD,eAAeM,EAAU,QAASnI,KAAKqI,0BAI/ErI,KAAKsC,eAAiB,MAQ1B5C,QAAQuG,UAAUoC,sBAAwB,WAExC,IAAI/B,EAAKtG,KAET,OAAO,SAAUwG,GAGfA,EAAEC,cAAe,EAEbD,EAAEE,iBAEJF,EAAEE,kBAQJ9G,OAAOC,KAAKyE,MAAM2D,QAAQ3B,EAAI,cAE9BA,EAAGgC,UAQP5I,QAAQuG,UAAU0B,QAAU,SAAUY,GAEpC,IAAI3F,EAEA4F,EAAU,EAAGC,EAAU,EAE3B,IAAKF,IAEH3F,EAAM5C,KAAKgF,oBAEQpF,OAAOC,KAAK6I,IAAK,CAE7B9F,EAAI+F,YAAYC,SAAS5I,KAAKW,YAGjCiC,EAAIiG,UAAU7I,KAAKW,WAGrB,IAAImI,EAAY9I,KAAKQ,aAAa6G,MAC9B0B,EAAY/I,KAAKQ,aAAawI,OAC9BC,EAAUjJ,KAAKqC,KAAKiF,YACpB4B,EAAWlJ,KAAKqC,KAAK8G,aACrBC,EAAOpJ,KAAK0B,kBAAkB2F,MAC9BgC,EAAOrJ,KAAK0B,kBAAkBsH,OAElC,GAA8B,GAA1BpG,EAAI0G,YAAY3E,OAAa,CAM/B,IAAI4E,EAAU,CAAC9B,KAAM,EAAGC,MAAO,EAAG8B,IAAK,EAAGC,OAAQ,GAClDF,EAAQ9B,MAAQqB,EAAYM,EAC5BG,EAAQ7B,MAAQoB,EAAYG,EAAUG,EAClCpJ,KAAK+B,cACPwH,EAAQC,KAAOT,EAAYM,EAAOH,EAClCK,EAAQE,OAASV,EAAYM,IAE7BE,EAAQC,KAAOT,EAAYM,EAC3BE,EAAQE,OAASV,EAAYG,EAAWG,GAE1CzG,EAAI0G,YAAY,IAAI1J,OAAOC,KAAK6J,aAAa1J,KAAKW,WAAY4I,OACzD,CACL,IAAII,EAAS/G,EAAIgH,SACbC,EAAWF,EAAOrC,YAClBwC,EAAYH,EAAOR,aACnBY,EAAc/J,KAAKgK,gBAAgBC,2BAA2BjK,KAAKW,WAqBvE,GAnBIoJ,EAAYG,GAAMpB,EAAYM,EAChCZ,EAAUuB,EAAYG,EAAIpB,EAAYM,EAC5BW,EAAYG,EAAIjB,EAAUH,EAAYM,EAAQS,IACxDrB,EAAUuB,EAAYG,EAAIjB,EAAUH,EAAYM,EAAOS,GAErD7J,KAAK+B,aACHgI,EAAYI,GAAMpB,EAAYM,EAAOH,EACvCT,EAAUsB,EAAYI,EAAIpB,EAAYM,EAAOH,EACnCa,EAAYI,EAAIpB,EAAYM,EAAQS,IAC9CrB,EAAUsB,EAAYI,EAAIpB,EAAYM,EAAOS,GAG3CC,EAAYI,GAAMpB,EAAYM,EAChCZ,EAAUsB,EAAYI,EAAIpB,EAAYM,EAC5BU,EAAYI,EAAIjB,EAAWH,EAAYM,EAAQS,IACzDrB,EAAUsB,EAAYI,EAAIjB,EAAWH,EAAYM,EAAOS,GAI1C,IAAZtB,GAA6B,IAAZC,EAAgB,CAI7B7F,EAAIwH,YACZxH,EAAIyH,MAAM7B,EAASC,OAY7B/I,QAAQuG,UAAUY,aAAe,WAE/B,IAAIV,EAAGhF,EAEP,GAAInB,KAAKqC,KAAM,CAUb,IAAK8D,KAPLnG,KAAKqC,KAAKiI,UAAYtK,KAAKgB,UAG3BhB,KAAKqC,KAAK+E,MAAMmD,QAAU,GAG1BpJ,EAAWnB,KAAKkB,UAGVC,EAASqJ,eAAerE,KAE1BnG,KAAKqC,KAAK+E,MAAMjB,GAAKhF,EAASgF,UAOc,IAApCnG,KAAKqC,KAAK+E,MAAMqD,kBAAgG,IAA3DzK,KAAKqC,KAAK+E,MAAMqD,gBAAgBC,QAAQ,gBAA+E,IAAvD1K,KAAKqC,KAAK+E,MAAMqD,gBAAgBC,QAAQ,aAEvK1K,KAAKqC,KAAK+E,MAAMqD,gBAAkB,sBAKG,IAA5BzK,KAAKqC,KAAK+E,MAAMuD,SAAuD,KAA5B3K,KAAKqC,KAAK+E,MAAMuD,UAEpE3K,KAAKqC,KAAK+E,MAAMwD,SAAW,oDAAkF,IAA1B5K,KAAKqC,KAAK+E,MAAMuD,QAAiB,KACpH3K,KAAKqC,KAAK+E,MAAMyD,OAAS,iBAA8C,IAA1B7K,KAAKqC,KAAK+E,MAAMuD,QAAiB,KAKhF3K,KAAKqC,KAAK+E,MAAMxG,SAAW,WAC3BZ,KAAKqC,KAAK+E,MAAM0D,WAAa,SACR,OAAjB9K,KAAKc,UAEPd,KAAKqC,KAAK+E,MAAMrG,OAASf,KAAKc,WAUpCpB,QAAQuG,UAAUuB,cAAgB,WAEhC,IAAIuD,EACA1E,EAAK,CAACmD,IAAK,EAAGC,OAAQ,EAAGhC,KAAM,EAAGC,MAAO,GACzCsD,EAAMhL,KAAKqC,KA2Bf,OAzBIsE,SAASsE,aAAetE,SAASsE,YAAYC,kBAE/CH,EAAgBC,EAAIG,cAAcF,YAAYC,iBAAiBF,EAAK,OAKlE3E,EAAGmD,IAAM4B,SAASL,EAAcM,eAAgB,KAAO,EACvDhF,EAAGoD,OAAS2B,SAASL,EAAcO,kBAAmB,KAAO,EAC7DjF,EAAGoB,KAAO2D,SAASL,EAAcQ,gBAAiB,KAAO,EACzDlF,EAAGqB,MAAQ0D,SAASL,EAAcS,iBAAkB,KAAO,GAGpD7E,SAAS8E,gBAAgBC,cAE9BV,EAAIU,eAGNrF,EAAGmD,IAAM4B,SAASJ,EAAIU,aAAaL,eAAgB,KAAO,EAC1DhF,EAAGoD,OAAS2B,SAASJ,EAAIU,aAAaJ,kBAAmB,KAAO,EAChEjF,EAAGoB,KAAO2D,SAASJ,EAAIU,aAAaH,gBAAiB,KAAO,EAC5DlF,EAAGqB,MAAQ0D,SAASJ,EAAIU,aAAaF,iBAAkB,KAAO,GAI3DnF,GAMT3G,QAAQuG,UAAU0F,SAAW,WAEvB3L,KAAKqC,OAEPrC,KAAKqC,KAAKuJ,WAAWC,YAAY7L,KAAKqC,MACtCrC,KAAKqC,KAAO,OAOhB3C,QAAQuG,UAAU6F,KAAO,WAEvB9L,KAAKkG,oBAEL,IAAI6D,EAAc/J,KAAKgK,gBAAgB+B,qBAAqB/L,KAAKW,WAEjEX,KAAKqC,KAAK+E,MAAMK,KAAQsC,EAAYG,EAAIlK,KAAKQ,aAAa6G,MAAS,KAE/DrH,KAAK+B,aACP/B,KAAKqC,KAAK+E,MAAMqC,SAAWM,EAAYI,EAAInK,KAAKQ,aAAawI,QAAU,KAEvEhJ,KAAKqC,KAAK+E,MAAMoC,IAAOO,EAAYI,EAAInK,KAAKQ,aAAawI,OAAU,KAGjEhJ,KAAK8B,UAEP9B,KAAKqC,KAAK+E,MAAM0D,WAAa,SAI7B9K,KAAKqC,KAAK+E,MAAM0D,WAAa,WAWjCpL,QAAQuG,UAAU+F,WAAa,SAAUrM,QACN,IAAtBA,EAASsB,WAElBjB,KAAKgB,UAAYrB,EAASsB,SAC1BjB,KAAK6G,qBAE0B,IAAtBlH,EAASwB,WAElBnB,KAAKkB,UAAYvB,EAASwB,SAC1BnB,KAAK6G,qBAEyB,IAArBlH,EAASQ,SAElBH,KAAKiM,WAAWtM,EAASQ,cAEY,IAA5BR,EAASU,iBAElBL,KAAKI,gBAAkBT,EAASU,qBAED,IAAtBV,EAASY,WAElBP,KAAKM,UAAYX,EAASY,eAEQ,IAAzBZ,EAASc,cAElBT,KAAKQ,aAAeb,EAASc,kBAEK,IAAzBd,EAASqC,cAElBhC,KAAK+B,aAAepC,EAASqC,kBAEE,IAAtBrC,EAASiB,UAElBZ,KAAKkM,YAAYvM,EAASiB,eAEG,IAApBjB,EAASoB,QAElBf,KAAKmM,UAAUxM,EAASoB,aAEa,IAA5BpB,EAAS0B,iBAElBrB,KAAKoB,gBAAkBzB,EAAS0B,qBAEE,IAAzB1B,EAAS4B,cAElBvB,KAAKsB,aAAe3B,EAAS4B,kBAEO,IAA3B5B,EAAS8B,gBAElBzB,KAAKwB,eAAiB7B,EAAS8B,oBAEQ,IAA9B9B,EAASgC,mBAElB3B,KAAK0B,kBAAoB/B,EAASgC,uBAEH,IAAtBhC,EAASkC,WAElB7B,KAAK8B,UAAYnC,EAASkC,eAEI,IAArBlC,EAASiC,UAElB5B,KAAK8B,WAAanC,EAASiC,cAEkB,IAApCjC,EAASyC,yBAElBpC,KAAKmC,wBAA0BxC,EAASyC,wBAGtCpC,KAAKqC,MAEPrC,KAAK8L,QASTpM,QAAQuG,UAAUgG,WAAa,SAAU9L,GACvCH,KAAKE,SAAWC,EAEZH,KAAKqC,OAEHrC,KAAKsC,iBAEP1C,OAAOC,KAAKyE,MAAM8H,eAAepM,KAAKsC,gBACtCtC,KAAKsC,eAAiB,MAKnBtC,KAAK0C,iBAER1C,KAAKqC,KAAK+E,MAAMC,MAAQ,SAGM,IAArBlH,EAAQ2G,SACjB9G,KAAKqC,KAAK0E,UAAY/G,KAAKgH,kBAAoB7G,GAE/CH,KAAKqC,KAAK0E,UAAY/G,KAAKgH,kBAC3BhH,KAAKqC,KAAK4E,YAAY9G,IAMnBH,KAAK0C,iBACR1C,KAAKqC,KAAK+E,MAAMC,MAAQrH,KAAKqC,KAAKiF,YAAc,UAChB,IAArBnH,EAAQ2G,SACjB9G,KAAKqC,KAAK0E,UAAY/G,KAAKgH,kBAAoB7G,GAE/CH,KAAKqC,KAAK0E,UAAY/G,KAAKgH,kBAC3BhH,KAAKqC,KAAK4E,YAAY9G,KAI1BH,KAAKmH,oBAQPvH,OAAOC,KAAKyE,MAAM2D,QAAQjI,KAAM,oBAOlCN,QAAQuG,UAAUiG,YAAc,SAAUG,GAExCrM,KAAKW,UAAY0L,EAEbrM,KAAKqC,MAEPrC,KAAK8L,OAQPlM,OAAOC,KAAKyE,MAAM2D,QAAQjI,KAAM,qBAOlCN,QAAQuG,UAAUkG,UAAY,SAAUG,GAEtCtM,KAAKc,QAAUwL,EAEXtM,KAAKqC,OAEPrC,KAAKqC,KAAK+E,MAAMrG,OAASuL,GAQ3B1M,OAAOC,KAAKyE,MAAM2D,QAAQjI,KAAM,mBAOlCN,QAAQuG,UAAUsG,WAAa,SAAUC,GAEvCxM,KAAK8B,WAAa0K,EACdxM,KAAKqC,OACPrC,KAAKqC,KAAK+E,MAAM0D,WAAc9K,KAAK8B,UAAY,SAAW,YAQ9DpC,QAAQuG,UAAUwG,WAAa,WAE7B,OAAOzM,KAAKE,UAOdR,QAAQuG,UAAUyG,YAAc,WAE9B,OAAO1M,KAAKW,WAOdjB,QAAQuG,UAAU0G,UAAY,WAE5B,OAAO3M,KAAKc,SAOdpB,QAAQuG,UAAU2G,WAAa,WAS7B,YAL8B,IAAlB5M,KAAKgF,UAAgD,OAAlBhF,KAAKgF,WAGrChF,KAAK8B,WAStBpC,QAAQuG,UAAU4G,SAAW,WAC3B,IAAIxF,EAAQ,KAMZ,OAJIrH,KAAKqC,OACPgF,EAAQrH,KAAKqC,KAAKiF,aAGbD,GAOT3H,QAAQuG,UAAU6G,UAAY,WAC5B,IAAI9D,EAAS,KAMb,OAJIhJ,KAAKqC,OACP2G,EAAShJ,KAAKqC,KAAK8G,cAGdH,GAMTtJ,QAAQuG,UAAU8G,KAAO,WAEvB/M,KAAK8B,WAAY,EACb9B,KAAKqC,OACPrC,KAAKqC,KAAK+E,MAAM0D,WAAa,YAOjCpL,QAAQuG,UAAU+G,KAAO,WAEvBhN,KAAK8B,WAAY,EACb9B,KAAKqC,OACPrC,KAAKqC,KAAK+E,MAAM0D,WAAa,WAYjCpL,QAAQuG,UAAUgH,KAAO,SAAUrK,EAAKsK,GAEtC,IAAI5G,EAAKtG,KAELkN,IAEFlN,KAAKkM,YAAYgB,EAAOR,eACxB1M,KAAKuC,cAAgB3C,OAAOC,KAAKyE,MAAMC,YAAY2I,EAAQ,mBAAoB,WAC7E5G,EAAG4F,YAAYlM,KAAK0M,kBAIxB1M,KAAKkE,OAAOtB,GAER5C,KAAKqC,MAEPrC,KAAK2H,QAAQ3H,KAAKI,kBAOtBV,QAAQuG,UAAUqC,MAAQ,WAExB,IAAInC,EAQJ,GANInG,KAAKsC,iBAEP1C,OAAOC,KAAKyE,MAAM8H,eAAepM,KAAKsC,gBACtCtC,KAAKsC,eAAiB,MAGpBtC,KAAKyC,gBAAiB,CAExB,IAAK0D,EAAI,EAAGA,EAAInG,KAAKyC,gBAAgBkC,OAAQwB,IAE3CvG,OAAOC,KAAKyE,MAAM8H,eAAepM,KAAKyC,gBAAgB0D,IAExDnG,KAAKyC,gBAAkB,KAGrBzC,KAAKuC,gBAEP3C,OAAOC,KAAKyE,MAAM8H,eAAepM,KAAKuC,eACtCvC,KAAKuC,cAAgB,MAGnBvC,KAAKwC,mBAEP5C,OAAOC,KAAKyE,MAAM8H,eAAepM,KAAKwC,kBACtCxC,KAAKwC,iBAAmB,MAG1BxC,KAAKkE,OAAO,OAoMdvB,gBAAgBsD,UAAUtC,2BAA6B,cASvDhB,gBAAgBsD,UAAUpC,gCAAkC,MAW5DlB,gBAAgBsD,UAAUlD,OAAS,SAASoK,EAAMC,GAChD,OAAO,SAAUC,GACf,IAAK,IAAIC,KAAYD,EAAOpH,UAC1BjG,KAAKiG,UAAUqH,GAAYD,EAAOpH,UAAUqH,GAE9C,OAAOtN,MACND,MAAMoN,EAAM,CAACC,KAQlBzK,gBAAgBsD,UAAUsH,MAAQ,WAChCvN,KAAKwN,WAAU,IAOjB7K,gBAAgBsD,UAAU6F,KAAO,aAOjCnJ,gBAAgBsD,UAAUhC,aAAe,WACvC,IAAIjE,KAAKoD,QAAQuB,OAIjB,IAAK,IAAW8I,EAAPtH,EAAI,EAASsH,EAAOzN,KAAKmD,MAAMgD,GAAIA,IAC1CnG,KAAKoD,QAAQwE,KAAK,CAChB8F,IAAK1N,KAAK0D,YAAcyC,EAAI,GAAK,IAAMnG,KAAK4D,gBAC5CoF,OAAQyE,EACRpG,MAAOoG,KAQb9K,gBAAgBsD,UAAU0H,gBAAkB,WAG1C,IAFA,IAEgBC,EAFZC,EAAU7N,KAAK8N,aACfC,EAAS,IAAInO,OAAOC,KAAK6J,aACpBvD,EAAI,EAAWyH,EAASC,EAAQ1H,GAAIA,IAC3C4H,EAAOhL,OAAO6K,EAAOlB,eAGvB1M,KAAKgD,KAAKgL,UAAUD,IAStBpL,gBAAgBsD,UAAUgI,UAAY,SAASvI,GAC7C1F,KAAKoD,QAAUsC,GASjB/C,gBAAgBsD,UAAUT,UAAY,WACpC,OAAOxF,KAAKoD,SASdT,gBAAgBsD,UAAUiI,cAAgB,WACxC,OAAOlO,KAAK8D,cAQdnB,gBAAgBsD,UAAUd,gBAAkB,WAC1C,OAAOnF,KAAKgE,gBASdrB,gBAAgBsD,UAAU6H,WAAa,WACrC,OAAO9N,KAAKiD,UASdN,gBAAgBsD,UAAUkI,gBAAkB,WAC1C,OAAOnO,KAAKiD,SAAS0B,QASvBhC,gBAAgBsD,UAAUmI,WAAa,SAASC,GAC9CrO,KAAKyD,SAAW4K,GASlB1L,gBAAgBsD,UAAUqI,WAAa,WACrC,OAAOtO,KAAKyD,UAYdd,gBAAgBsD,UAAUsI,YAAc,SAASV,EAASW,GAIxD,IAHA,IAAIlC,EAAQ,EACRmC,EAAQZ,EAAQlJ,OAChB+J,EAAKD,EACK,IAAPC,GACLA,EAAKtD,SAASsD,EAAK,GAAI,IACvBpC,IAIF,MAAO,CACLqC,KAAMF,EACNnC,MAHFA,EAAQsC,KAAKC,IAAIvC,EAAOkC,KAgB1B7L,gBAAgBsD,UAAU6I,cAAgB,SAASC,GACjD/O,KAAKuO,YAAcQ,GASrBpM,gBAAgBsD,UAAU+I,cAAgB,WACxC,OAAOhP,KAAKuO,aAUd5L,gBAAgBsD,UAAUrB,WAAa,SAASiJ,EAASoB,GACvD,IAAK,IAAWrB,EAAPzH,EAAI,EAAWyH,EAASC,EAAQ1H,GAAIA,IAC3CnG,KAAKkP,cAActB,GAEhBqB,GACHjP,KAAK0E,UAWT/B,gBAAgBsD,UAAUiJ,cAAgB,SAAStB,GAEjD,GADAA,EAAOuB,SAAU,EACbvB,EAAkB,UAAG,CAGvB,IAAIvJ,EAAOrE,KACXJ,OAAOC,KAAKyE,MAAMC,YAAYqJ,EAAQ,UAAW,WAC/CA,EAAOuB,SAAU,EACjB9K,EAAK+K,YAGTpP,KAAKiD,SAAS2E,KAAKgG,IAUrBjL,gBAAgBsD,UAAUoJ,UAAY,SAASzB,EAAQqB,GACrDjP,KAAKkP,cAActB,GACdqB,GACHjP,KAAK0E,UAYT/B,gBAAgBsD,UAAUqJ,cAAgB,SAAS1B,GACjD,IAAItB,GAAS,EACb,GAAItM,KAAKiD,SAASyH,QAChB4B,EAAQtM,KAAKiD,SAASyH,QAAQkD,QAE9B,IAAK,IAAW2B,EAAPpJ,EAAI,EAAMoJ,EAAIvP,KAAKiD,SAASkD,GAAIA,IACvC,GAAIoJ,GAAK3B,EAAQ,CACftB,EAAQnG,EACR,MAKN,OAAc,GAAVmG,IAKJsB,EAAO1J,OAAO,MAEdlE,KAAKiD,SAASuM,OAAOlD,EAAO,IAErB,IAWT3J,gBAAgBsD,UAAUwJ,aAAe,SAAS7B,EAAQqB,GACxD,IAAIS,EAAU1P,KAAKsP,cAAc1B,GAEjC,QAAKqB,IAAcS,KACjB1P,KAAKyE,gBACLzE,KAAK0E,UACE,IAaX/B,gBAAgBsD,UAAU0J,cAAgB,SAAS9B,EAASoB,GAG1D,IAFA,IAEgBrB,EAFZ8B,GAAU,EAELvJ,EAAI,EAAWyH,EAASC,EAAQ1H,GAAIA,IAAK,CAChD,IAAIyJ,EAAI5P,KAAKsP,cAAc1B,GAC3B8B,EAAUA,GAAWE,EAGvB,IAAKX,GAAcS,EAGjB,OAFA1P,KAAKyE,gBACLzE,KAAK0E,UACE,GAWX/B,gBAAgBsD,UAAUuH,UAAY,SAASqC,GACxC7P,KAAKqD,SACRrD,KAAKqD,OAASwM,EACd7P,KAAK8P,oBAUTnN,gBAAgBsD,UAAU8J,iBAAmB,WAC3C,OAAO/P,KAAKkD,UAAUyB,QASxBhC,gBAAgBsD,UAAUjB,OAAS,WACjC,OAAOhF,KAAKgD,MASdL,gBAAgBsD,UAAU/B,OAAS,SAAStB,GAC1C5C,KAAKgD,KAAOJ,GASdD,gBAAgBsD,UAAUhB,YAAc,WACtC,OAAOjF,KAAKuD,WASdZ,gBAAgBsD,UAAU+J,YAAc,SAASvC,GAC/CzN,KAAKuD,UAAYkK,GASnB9K,gBAAgBsD,UAAUf,kBAAoB,WAC5C,OAAOlF,KAAKwD,iBAQdb,gBAAgBsD,UAAUgK,kBAAoB,SAASxC,GACrDzN,KAAKwD,gBAAkBiK,GAUzB9K,gBAAgBsD,UAAUiK,kBAAoB,SAASnC,GACrD,IAAIoC,EAAanQ,KAAKgK,gBAGlBoG,EAAK,IAAIxQ,OAAOC,KAAKgB,OAAOkN,EAAOsC,eAAeC,MAClDvC,EAAOsC,eAAeE,OACtBC,EAAK,IAAI5Q,OAAOC,KAAKgB,OAAOkN,EAAO0C,eAAeH,MAClDvC,EAAO0C,eAAeF,OAGtBG,EAAQP,EAAWpE,qBAAqBqE,GAC5CM,EAAMxG,GAAKlK,KAAKuD,UAChBmN,EAAMvG,GAAKnK,KAAKuD,UAEhB,IAAIoN,EAAQR,EAAWpE,qBAAqByE,GAC5CG,EAAMzG,GAAKlK,KAAKuD,UAChBoN,EAAMxG,GAAKnK,KAAKuD,UAGhB,IAAIqN,EAAKT,EAAWU,qBAAqBH,GACrCI,EAAKX,EAAWU,qBAAqBF,GAMzC,OAHA5C,EAAOhL,OAAO6N,GACd7C,EAAOhL,OAAO+N,GAEP/C,GAYTpL,gBAAgBsD,UAAU8K,kBAAoB,SAASnD,EAAQG,GAC7D,OAAOA,EAAOnF,SAASgF,EAAOlB,gBAOhC/J,gBAAgBsD,UAAU+K,aAAe,WACvChR,KAAKyE,eAAc,GAGnBzE,KAAKiD,SAAW,IAQlBN,gBAAgBsD,UAAUxB,cAAgB,SAASwM,GAEjD,IAAK,IAAWxL,EAAPU,EAAI,EAAYV,EAAUzF,KAAKkD,UAAUiD,GAAIA,IACpDV,EAAQyL,SAIL,IAAWtD,EAAhB,IAASzH,EAAI,EAAWyH,EAAS5N,KAAKiD,SAASkD,GAAIA,IACjDyH,EAAOuB,SAAU,EACb8B,GACFrD,EAAO1J,OAAO,MAIlBlE,KAAKkD,UAAY,IAMnBP,gBAAgBsD,UAAUmJ,QAAU,WAClC,IAAI+B,EAAcnR,KAAKkD,UAAUkO,QACjCpR,KAAKkD,UAAUyB,OAAS,EACxB3E,KAAKyE,gBACLzE,KAAK0E,SAIL2M,OAAOC,WAAW,WAChB,IAAK,IAAW7L,EAAPU,EAAI,EAAYV,EAAU0L,EAAYhL,GAAIA,IACjDV,EAAQyL,UAET,IAOLvO,gBAAgBsD,UAAUvB,OAAS,WACjC1E,KAAK8P,mBAaPnN,gBAAgBsD,UAAUsL,uBAAyB,SAASC,EAAIC,GAC9D,IAAKD,IAAOC,EACV,OAAO,EAGT,IACIC,GAAQD,EAAGnB,MAAQkB,EAAGlB,OAAS1B,KAAK+C,GAAK,IACzCC,GAAQH,EAAGlB,MAAQiB,EAAGjB,OAAS3B,KAAK+C,GAAK,IACzCE,EAAIjD,KAAKkD,IAAIJ,EAAO,GAAK9C,KAAKkD,IAAIJ,EAAO,GAC3C9C,KAAKmD,IAAIP,EAAGlB,MAAQ1B,KAAK+C,GAAK,KAAO/C,KAAKmD,IAAIN,EAAGnB,MAAQ1B,KAAK+C,GAAK,KACnE/C,KAAKkD,IAAIF,EAAO,GAAKhD,KAAKkD,IAAIF,EAAO,GAGvC,OARQ,MAMA,EAAIhD,KAAKoD,MAAMpD,KAAKqD,KAAKJ,GAAIjD,KAAKqD,KAAK,EAAIJ,MAYrDlP,gBAAgBsD,UAAUiM,qBAAuB,SAAStE,GAIxD,IAHA,IAiBMnI,EAjBF0M,EAAW,IACXC,EAAiB,KAEZjM,GADCyH,EAAOlB,cACJ,GAAYjH,EAAUzF,KAAKkD,UAAUiD,GAAIA,IAAK,CACzD,IAAIkM,EAAS5M,EAAQ2E,YACrB,GAAIiI,EAAQ,CACV,IAAIC,EAAItS,KAAKuR,uBAAuBc,EAAQzE,EAAOlB,eAC/C4F,EAAIH,IACNA,EAAWG,EACXF,EAAiB3M,IAKnB2M,GAAkBA,EAAeG,wBAAwB3E,GAC3DwE,EAAe/C,UAAUzB,KAErBnI,EAAU,IAAIZ,QAAQ7E,OAClBqP,UAAUzB,GAClB5N,KAAKkD,UAAU0E,KAAKnC,KAUxB9C,gBAAgBsD,UAAU6J,gBAAkB,WAC1C,GAAK9P,KAAKqD,OAUV,IAJA,IAIgBuK,EAJZ4E,EAAY,IAAI5S,OAAOC,KAAK6J,aAAa1J,KAAKgD,KAAK2F,YAAY8H,eAC/DzQ,KAAKgD,KAAK2F,YAAY0H,gBACtBtC,EAAS/N,KAAKkQ,kBAAkBsC,GAE3BrM,EAAI,EAAWyH,EAAS5N,KAAKiD,SAASkD,GAAIA,KAC5CyH,EAAOuB,SAAWnP,KAAK+Q,kBAAkBnD,EAAQG,IACpD/N,KAAKkS,qBAAqBtE,IAiChC/I,QAAQoB,UAAUwM,qBAAuB,SAAS7E,GAChD,GAAI5N,KAAKiD,SAASyH,QAChB,OAAyC,GAAlC1K,KAAKiD,SAASyH,QAAQkD,GAE7B,IAAK,IAAW2B,EAAPpJ,EAAI,EAAMoJ,EAAIvP,KAAKiD,SAASkD,GAAIA,IACvC,GAAIoJ,GAAK3B,EACP,OAAO,EAIb,OAAO,GAUT/I,QAAQoB,UAAUoJ,UAAY,SAASzB,GACrC,GAAI5N,KAAKyS,qBAAqB7E,GAC5B,OAAO,EAGT,GAAK5N,KAAKoF,SAIR,GAAIpF,KAAKgE,eAAgB,CACvB,IAAI0O,EAAI1S,KAAKiD,SAAS0B,OAAS,EAC3B2L,GAAOtQ,KAAKoF,QAAQkL,OAASoC,EAAE,GAAK9E,EAAOlB,cAAc4D,OAASoC,EAClEnC,GAAOvQ,KAAKoF,QAAQmL,OAASmC,EAAE,GAAK9E,EAAOlB,cAAc6D,OAASmC,EACtE1S,KAAKoF,QAAU,IAAIxF,OAAOC,KAAKgB,OAAOyP,EAAKC,GAC3CvQ,KAAK2S,yBARP3S,KAAKoF,QAAUwI,EAAOlB,cACtB1M,KAAK2S,mBAWP/E,EAAOuB,SAAU,EACjBnP,KAAKiD,SAAS2E,KAAKgG,GAEnB,IAAIgF,EAAM5S,KAAKiD,SAAS0B,OAMxB,GALIiO,EAAM5S,KAAKwD,iBAAmBoK,EAAO5I,UAAYhF,KAAKgD,MAExD4K,EAAO1J,OAAOlE,KAAKgD,MAGjB4P,GAAO5S,KAAKwD,gBAEd,IAAK,IAAI2C,EAAI,EAAGA,EAAIyM,EAAKzM,IACvBnG,KAAKiD,SAASkD,GAAGjC,OAAO,MAS5B,OALI0O,GAAO5S,KAAKwD,iBACdoK,EAAO1J,OAAO,MAGhBlE,KAAK6S,cACE,GASThO,QAAQoB,UAAUL,mBAAqB,WACrC,OAAO5F,KAAK+E,kBASdF,QAAQoB,UAAU0C,UAAY,WAG5B,IAFA,IAEgBiF,EAFZG,EAAS,IAAInO,OAAOC,KAAK6J,aAAa1J,KAAKoF,QAASpF,KAAKoF,SACzDyI,EAAU7N,KAAK8N,aACV3H,EAAI,EAAWyH,EAASC,EAAQ1H,GAAIA,IAC3C4H,EAAOhL,OAAO6K,EAAOlB,eAEvB,OAAOqB,GAOTlJ,QAAQoB,UAAUiL,OAAS,WACzBlR,KAAKsF,aAAa4L,SAClBlR,KAAKiD,SAAS0B,OAAS,SAChB3E,KAAKiD,UASd4B,QAAQoB,UAAU6M,QAAU,WAC1B,OAAO9S,KAAKiD,SAAS0B,QASvBE,QAAQoB,UAAU6H,WAAa,WAC7B,OAAO9N,KAAKiD,UASd4B,QAAQoB,UAAUmE,UAAY,WAC5B,OAAOpK,KAAKoF,SASdP,QAAQoB,UAAU0M,iBAAmB,WACnC,IAAI5E,EAAS,IAAInO,OAAOC,KAAK6J,aAAa1J,KAAKoF,QAASpF,KAAKoF,SAC7DpF,KAAKqF,QAAUrF,KAAK+E,iBAAiBmL,kBAAkBnC,IAUzDlJ,QAAQoB,UAAUsM,wBAA0B,SAAS3E,GACnD,OAAO5N,KAAKqF,QAAQuD,SAASgF,EAAOlB,gBAStC7H,QAAQoB,UAAUjB,OAAS,WACzB,OAAOhF,KAAKgD,MAOd6B,QAAQoB,UAAU4M,WAAa,WAC7B,IAAIrO,EAAOxE,KAAKgD,KAAKoB,UACjB2O,EAAK/S,KAAK+E,iBAAiBuJ,aAE/B,GAAIyE,GAAMvO,EAAOuO,EAEf,IAAK,IAAWnF,EAAPzH,EAAI,EAAWyH,EAAS5N,KAAKiD,SAASkD,GAAIA,IACjDyH,EAAO1J,OAAOlE,KAAKgD,WAKvB,GAAIhD,KAAKiD,SAAS0B,OAAS3E,KAAKwD,gBAE9BxD,KAAKsF,aAAa0H,WAFpB,CAMA,IAAIwB,EAAYxO,KAAK+E,iBAAiBS,YAAYb,OAC9CqO,EAAOhT,KAAK+E,iBAAiBiK,eAAtBhP,CAAsCA,KAAKiD,SAAUuL,GAChExO,KAAKsF,aAAauD,UAAU7I,KAAKoF,SACjCpF,KAAKsF,aAAa2N,QAAQD,GAC1BhT,KAAKsF,aAAayH,SA0CpBxH,YAAYU,UAAUiN,oBAAsB,SAAS5O,GACnD,IAAIQ,EAAkB9E,KAAK8F,SAASF,qBAGpChG,OAAOC,KAAKyE,MAAM2D,QAAQnD,EAAiB,eAAgB9E,KAAK8F,SAAUxB,GAEtEQ,EAAgBoJ,iBAElBlO,KAAKgD,KAAKgL,UAAUhO,KAAK8F,SAAS6C,cAStCpD,YAAYU,UAAUsH,MAAQ,WAI5B,GAHAvN,KAAKqC,KAAOsE,SAASC,cAAc,OACnC5G,KAAKqC,KAAKiI,UAAU,UAEhBtK,KAAKgG,SAAU,CACjB,IAAImN,EAAMnT,KAAKoT,kBAAkBpT,KAAKoF,SACtCpF,KAAKqC,KAAK+E,MAAMmD,QAAUvK,KAAKqT,UAAUF,GACzCnT,KAAKqC,KAAK0E,UAAY/G,KAAK+F,MAAM4I,KACjC3O,KAAKqC,KAAKiI,UAAU,kBAGVtK,KAAKkH,WACXoM,mBAAmBrM,YAAYjH,KAAKqC,MAE1C,IAAIgC,EAAOrE,KACPuT,GAAa,EACjB3T,OAAOC,KAAKyE,MAAMuD,eAAe7H,KAAKqC,KAAM,QAAS,SAASiC,GAEvDiP,GACHlP,EAAK6O,oBAAoB5O,KAG7B1E,OAAOC,KAAKyE,MAAMuD,eAAe7H,KAAKqC,KAAM,YAAa,WACvDkR,GAAa,IAEf3T,OAAOC,KAAKyE,MAAMuD,eAAe7H,KAAKqC,KAAM,YAAa,WACvDkR,GAAa,KAYjBhO,YAAYU,UAAUmN,kBAAoB,SAAS/G,GACjD,IAAI8G,EAAMnT,KAAKgK,gBAAgB+B,qBAAqBM,GASpD,MAPgC,iBAArBrM,KAAKwT,aAAwD,IAA5BxT,KAAKwT,YAAY7O,QAC3DwO,EAAIjJ,GAAKlK,KAAKwT,YAAY,GAC1BL,EAAIhJ,GAAKnK,KAAKwT,YAAY,KAE1BL,EAAIjJ,GAAKkB,SAASpL,KAAKyT,OAAS,EAAG,IACnCN,EAAIhJ,GAAKiB,SAASpL,KAAK0T,QAAU,EAAG,KAE/BP,GAQT5N,YAAYU,UAAU6F,KAAO,WAC3B,GAAI9L,KAAKgG,SAAU,CACjB,IAAImN,EAAMnT,KAAKoT,kBAAkBpT,KAAKoF,SACtCpF,KAAKqC,KAAK+E,MAAMoC,IAAM2J,EAAIhJ,EAAI,KAC9BnK,KAAKqC,KAAK+E,MAAMK,KAAO0L,EAAIjJ,EAAI,OAQnC3E,YAAYU,UAAU+G,KAAO,WACvBhN,KAAKqC,OACPrC,KAAKqC,KAAK+E,MAAMuM,QAAU,QAE5B3T,KAAKgG,UAAW,GAOlBT,YAAYU,UAAU8G,KAAO,WAC3B,GAAI/M,KAAKqC,KAAM,CACb,IAAI8Q,EAAMnT,KAAKoT,kBAAkBpT,KAAKoF,SACtCpF,KAAKqC,KAAK+E,MAAMmD,QAAUvK,KAAKqT,UAAUF,GACzCnT,KAAKqC,KAAK+E,MAAMuM,QAAU,GAE5B3T,KAAKgG,UAAW,GAOlBT,YAAYU,UAAUiL,OAAS,WAC7BlR,KAAKkE,OAAO,OAQdqB,YAAYU,UAAU0F,SAAW,WAC3B3L,KAAKqC,MAAQrC,KAAKqC,KAAKuJ,aACzB5L,KAAKgN,OACLhN,KAAKqC,KAAKuJ,WAAWC,YAAY7L,KAAKqC,MACtCrC,KAAKqC,KAAO,OAYhBkD,YAAYU,UAAUgN,QAAU,SAASD,GACvChT,KAAK+F,MAAQiN,EACbhT,KAAK4T,MAAQZ,EAAKrE,KAClB3O,KAAK6T,OAASb,EAAK1G,MACftM,KAAKqC,OACPrC,KAAKqC,KAAK0E,UAAYiM,EAAKrE,MAG7B3O,KAAK8T,YAOPvO,YAAYU,UAAU6N,SAAW,WAC/B,IAAIxH,EAAQsC,KAAKmF,IAAI,EAAG/T,KAAK+F,MAAMuG,MAAQ,GAC3CA,EAAQsC,KAAKC,IAAI7O,KAAKoD,QAAQuB,OAAS,EAAG2H,GAC1C,IAAIlF,EAAQpH,KAAKoD,QAAQkJ,GACzBtM,KAAKgU,KAAO5M,EAAW,IACvBpH,KAAK0T,QAAUtM,EAAc,OAC7BpH,KAAKyT,OAASrM,EAAa,MAC3BpH,KAAKiU,WAAa7M,EAAiB,UACnCpH,KAAKkU,QAAU9M,EAAc,OAC7BpH,KAAKmU,UAAY/M,EAAgB,SACjCpH,KAAKoU,oBAAsBhN,EAA0B,mBACrDpH,KAAKwT,YAAcpM,EAAkB,YASvC7B,YAAYU,UAAU4C,UAAY,SAASwJ,GACzCrS,KAAKoF,QAAUiN,GAUjB9M,YAAYU,UAAUoN,UAAY,SAASF,GACzC,IAAI/L,EAAQ,GACZA,EAAMQ,KAAK,wBAA0B5H,KAAKgU,KAAO,MACjD,IAAIK,EAAqBrU,KAAKoU,oBAAsBpU,KAAKoU,oBAAsB,MAC/EhN,EAAMQ,KAAK,uBAAyByM,EAAqB,KAE7B,iBAAjBrU,KAAKkU,SACiB,iBAApBlU,KAAKkU,QAAQ,IAAmBlU,KAAKkU,QAAQ,GAAK,GACzDlU,KAAKkU,QAAQ,GAAKlU,KAAK0T,QACzBtM,EAAMQ,KAAK,WAAa5H,KAAK0T,QAAU1T,KAAKkU,QAAQ,IAChD,mBAAqBlU,KAAKkU,QAAQ,GAAK,OACP,iBAApBlU,KAAKkU,QAAQ,IAAmBlU,KAAKkU,QAAQ,GAAK,IAC/DlU,KAAKkU,QAAQ,GAAKlU,KAAK0T,QAC1BtM,EAAMQ,KAAK,UAAY5H,KAAK0T,QAAU,oBAAsB1T,KAAK0T,QAAU1T,KAAKkU,QAAQ,IACpF,OAEJ9M,EAAMQ,KAAK,UAAY5H,KAAK0T,QAAU,mBAAqB1T,KAAK0T,QAC5D,OAEyB,iBAApB1T,KAAKkU,QAAQ,IAAmBlU,KAAKkU,QAAQ,GAAK,GACzDlU,KAAKkU,QAAQ,GAAKlU,KAAKyT,OACzBrM,EAAMQ,KAAK,UAAY5H,KAAKyT,OAASzT,KAAKkU,QAAQ,IAC9C,oBAAsBlU,KAAKkU,QAAQ,GAAK,OAE5C9M,EAAMQ,KAAK,SAAW5H,KAAKyT,OAAS,2BAGtCrM,EAAMQ,KAAK,UAAY5H,KAAK0T,QAAU,mBAClC1T,KAAK0T,QAAU,aAAe1T,KAAKyT,OAAS,0BAGlD,IAAIa,EAAWtU,KAAKiU,WAAajU,KAAKiU,WAAa,QAC/CM,EAAUvU,KAAKmU,UAAYnU,KAAKmU,UAAY,GAKhD,OAHA/M,EAAMQ,KAAK,uBAAyBuL,EAAIhJ,EAAI,YACxCgJ,EAAIjJ,EAAI,aAAeoK,EAAW,kCAClCC,EAAU,sDACPnN,EAAMoN,KAAK,KAOpBnD,OAAwB,gBAAI1O,gBAC5BA,gBAAgBsD,UAAqB,UAAItD,gBAAgBsD,UAAUoJ,UACnE1M,gBAAgBsD,UAAsB,WAAItD,gBAAgBsD,UAAUrB,WACpEjC,gBAAgBsD,UAAwB,aACpCtD,gBAAgBsD,UAAU+K,aAC9BrO,gBAAgBsD,UAA2B,gBACvCtD,gBAAgBsD,UAAU0H,gBAC9BhL,gBAAgBsD,UAAyB,cACrCtD,gBAAgBsD,UAAU+I,cAC9BrM,gBAAgBsD,UAAuB,YACnCtD,gBAAgBsD,UAAUhB,YAC9BtC,gBAAgBsD,UAA6B,kBACzCtD,gBAAgBsD,UAAUiK,kBAC9BvN,gBAAgBsD,UAAkB,OAAItD,gBAAgBsD,UAAUjB,OAChErC,gBAAgBsD,UAAsB,WAAItD,gBAAgBsD,UAAU6H,WACpEnL,gBAAgBsD,UAAsB,WAAItD,gBAAgBsD,UAAUqI,WACpE3L,gBAAgBsD,UAAqB,UAAItD,gBAAgBsD,UAAUT,UACnE7C,gBAAgBsD,UAA4B,iBACxCtD,gBAAgBsD,UAAU8J,iBAC9BpN,gBAAgBsD,UAA2B,gBACvCtD,gBAAgBsD,UAAUkI,gBAC9BxL,gBAAgBsD,UAAkB,OAAItD,gBAAgBsD,UAAUvB,OAChE/B,gBAAgBsD,UAAwB,aACpCtD,gBAAgBsD,UAAUwJ,aAC9B9M,gBAAgBsD,UAAyB,cACrCtD,gBAAgBsD,UAAU0J,cAC9BhN,gBAAgBsD,UAAyB,cACrCtD,gBAAgBsD,UAAUxB,cAC9B9B,gBAAgBsD,UAAmB,QAC/BtD,gBAAgBsD,UAAUmJ,QAC9BzM,gBAAgBsD,UAAyB,cACrCtD,gBAAgBsD,UAAU6I,cAC9BnM,gBAAgBsD,UAAuB,YACnCtD,gBAAgBsD,UAAU+J,YAC9BrN,gBAAgBsD,UAAsB,WAClCtD,gBAAgBsD,UAAUmI,WAC9BzL,gBAAgBsD,UAAiB,MAAItD,gBAAgBsD,UAAUsH,MAC/D5K,gBAAgBsD,UAAgB,KAAItD,gBAAgBsD,UAAU6F,KAE9DjH,QAAQoB,UAAqB,UAAIpB,QAAQoB,UAAUmE,UACnDvF,QAAQoB,UAAmB,QAAIpB,QAAQoB,UAAU6M,QACjDjO,QAAQoB,UAAsB,WAAIpB,QAAQoB,UAAU6H,WAEpDvI,YAAYU,UAAiB,MAAIV,YAAYU,UAAUsH,MACvDhI,YAAYU,UAAgB,KAAIV,YAAYU,UAAU6F,KACtDvG,YAAYU,UAAoB,SAAIV,YAAYU,UAAU0F","file":"map.plugins.js","sourcesContent":["/**\r\n * @name InfoBox\r\n * @version 1.1.19 [April 6, 2018]\r\n * @author Gary Little (inspired by proof-of-concept code from Pamela Fox of Google)\r\n * @copyright Copyright 2010 Gary Little [gary at luxcentral.com]\r\n * @fileoverview InfoBox extends the Google Maps JavaScript API V3 <tt>OverlayView</tt> class.\r\n *  <p>\r\n *  An InfoBox behaves like a <tt>google.maps.InfoWindow</tt>, but it supports several\r\n *  additional properties for advanced styling. An InfoBox can also be used as a map label.\r\n *  <p>\r\n *  An InfoBox also fires the same events as a <tt>google.maps.InfoWindow</tt>.\r\n */\r\n\r\n/*!\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *       http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/*jslint browser:true */\r\n/*global google */\r\n\r\n/**\r\n * @name InfoBoxOptions\r\n * @class This class represents the optional parameter passed to the {@link InfoBox} constructor.\r\n * @property {string|Node} content The content of the InfoBox (plain text or an HTML DOM node).\r\n * @property {boolean} [disableAutoPan=false] Disable auto-pan on <tt>open</tt>.\r\n * @property {number} maxWidth The maximum width (in pixels) of the InfoBox. Set to 0 if no maximum.\r\n * @property {Size} pixelOffset The offset (in pixels) from the top left corner of the InfoBox\r\n *  (or the bottom left corner if the <code>alignBottom</code> property is <code>true</code>)\r\n *  to the map pixel corresponding to <tt>position</tt>.\r\n * @property {LatLng} position The geographic location at which to display the InfoBox.\r\n * @property {number} zIndex The CSS z-index style value for the InfoBox.\r\n *  Note: This value overrides a zIndex setting specified in the <tt>boxStyle</tt> property.\r\n * @property {string} [boxClass=\"infoBox\"] The name of the CSS class defining the styles for the InfoBox container.\r\n * @property {Object} [boxStyle] An object literal whose properties define specific CSS\r\n *  style values to be applied to the InfoBox. Style values defined here override those that may\r\n *  be defined in the <code>boxClass</code> style sheet. If this property is changed after the\r\n *  InfoBox has been created, all previously set styles (except those defined in the style sheet)\r\n *  are removed from the InfoBox before the new style values are applied.\r\n * @property {string} closeBoxMargin The CSS margin style value for the close box.\r\n *  The default is \"2px\" (a 2-pixel margin on all sides).\r\n * @property {string} closeBoxTitle The tool tip for the close box. The default is \" Close \".\r\n * @property {string} closeBoxURL The URL of the image representing the close box.\r\n *  Note: The default is the URL for Google's standard close box.\r\n *  Set this property to \"\" if no close box is required.\r\n * @property {Size} infoBoxClearance Minimum offset (in pixels) from the InfoBox to the\r\n *  map edge after an auto-pan.\r\n * @property {boolean} [isHidden=false] Hide the InfoBox on <tt>open</tt>.\r\n *  [Deprecated in favor of the <tt>visible</tt> property.]\r\n * @property {boolean} [visible=true] Show the InfoBox on <tt>open</tt>.\r\n * @property {boolean} alignBottom Align the bottom left corner of the InfoBox to the <code>position</code>\r\n *  location (default is <tt>false</tt> which means that the top left corner of the InfoBox is aligned).\r\n * @property {string} pane The pane where the InfoBox is to appear (default is \"floatPane\").\r\n *  Set the pane to \"mapPane\" if the InfoBox is being used as a map label.\r\n *  Valid pane names are the property names for the <tt>google.maps.MapPanes</tt> object.\r\n * @property {boolean} enableEventPropagation Propagate mousedown, mousemove, mouseover, mouseout,\r\n *  mouseup, click, dblclick, touchstart, touchend, touchmove, and contextmenu events in the InfoBox\r\n *  (default is <tt>false</tt> to mimic the behavior of a <tt>google.maps.InfoWindow</tt>). Set\r\n *  this property to <tt>true</tt> if the InfoBox is being used as a map label.\r\n */\r\n\r\n/**\r\n * Creates an InfoBox with the options specified in {@link InfoBoxOptions}.\r\n *  Call <tt>InfoBox.open</tt> to add the box to the map.\r\n * @constructor\r\n * @param {InfoBoxOptions} [opt_opts]\r\n */\r\nfunction InfoBox(opt_opts) {\r\n\r\n  opt_opts = opt_opts || {};\r\n\r\n  google.maps.OverlayView.apply(this, arguments);\r\n\r\n  // Standard options (in common with google.maps.InfoWindow):\r\n  //\r\n  this.content_ = opt_opts.content || \"\";\r\n  this.disableAutoPan_ = opt_opts.disableAutoPan || false;\r\n  this.maxWidth_ = opt_opts.maxWidth || 0;\r\n  this.pixelOffset_ = opt_opts.pixelOffset || new google.maps.Size(0, 0);\r\n  this.position_ = opt_opts.position || new google.maps.LatLng(0, 0);\r\n  this.zIndex_ = opt_opts.zIndex || null;\r\n\r\n  // Additional options (unique to InfoBox):\r\n  //\r\n  this.boxClass_ = opt_opts.boxClass || \"infoBox\";\r\n  this.boxStyle_ = opt_opts.boxStyle || {};\r\n  this.closeBoxMargin_ = opt_opts.closeBoxMargin || \"2px\";\r\n  this.closeBoxURL_ = opt_opts.closeBoxURL || \"//www.google.com/intl/en_us/mapfiles/close.gif\";\r\n  if (opt_opts.closeBoxURL === \"\") {\r\n    this.closeBoxURL_ = \"\";\r\n  }\r\n  this.closeBoxTitle_ = opt_opts.closeBoxTitle || \" Close \";\r\n  this.infoBoxClearance_ = opt_opts.infoBoxClearance || new google.maps.Size(1, 1);\r\n\r\n  if (typeof opt_opts.visible === \"undefined\") {\r\n    if (typeof opt_opts.isHidden === \"undefined\") {\r\n      opt_opts.visible = true;\r\n    } else {\r\n      opt_opts.visible = !opt_opts.isHidden;\r\n    }\r\n  }\r\n  this.isHidden_ = !opt_opts.visible;\r\n\r\n  this.alignBottom_ = opt_opts.alignBottom || false;\r\n  this.pane_ = opt_opts.pane || \"floatPane\";\r\n  this.enableEventPropagation_ = opt_opts.enableEventPropagation || false;\r\n\r\n  this.div_ = null;\r\n  this.closeListener_ = null;\r\n  this.moveListener_ = null;\r\n  this.contextListener_ = null;\r\n  this.eventListeners_ = null;\r\n  this.fixedWidthSet_ = null;\r\n}\r\n\r\n/* InfoBox extends OverlayView in the Google Maps API v3.\r\n */\r\nInfoBox.prototype = new google.maps.OverlayView();\r\n\r\n/**\r\n * Creates the DIV representing the InfoBox.\r\n * @private\r\n */\r\nInfoBox.prototype.createInfoBoxDiv_ = function () {\r\n\r\n  var i;\r\n  var events;\r\n  var bw;\r\n  var me = this;\r\n\r\n  // This handler prevents an event in the InfoBox from being passed on to the map.\r\n  //\r\n  var cancelHandler = function (e) {\r\n    e.cancelBubble = true;\r\n    if (e.stopPropagation) {\r\n      e.stopPropagation();\r\n    }\r\n  };\r\n\r\n  // This handler ignores the current event in the InfoBox and conditionally prevents\r\n  // the event from being passed on to the map. It is used for the contextmenu event.\r\n  //\r\n  var ignoreHandler = function (e) {\r\n\r\n    e.returnValue = false;\r\n\r\n    if (e.preventDefault) {\r\n\r\n      e.preventDefault();\r\n    }\r\n\r\n    if (!me.enableEventPropagation_) {\r\n\r\n      cancelHandler(e);\r\n    }\r\n  };\r\n\r\n  if (!this.div_) {\r\n\r\n    this.div_ = document.createElement(\"div\");\r\n\r\n    this.setBoxStyle_();\r\n\r\n    if (typeof this.content_.nodeType === \"undefined\") {\r\n      this.div_.innerHTML = this.getCloseBoxImg_() + this.content_;\r\n    } else {\r\n      this.div_.innerHTML = this.getCloseBoxImg_();\r\n      this.div_.appendChild(this.content_);\r\n    }\r\n\r\n    // Add the InfoBox DIV to the DOM\r\n    this.getPanes()[this.pane_].appendChild(this.div_);\r\n\r\n    this.addClickHandler_();\r\n\r\n    if (this.div_.style.width) {\r\n\r\n      this.fixedWidthSet_ = true;\r\n\r\n    } else {\r\n\r\n      if (this.maxWidth_ !== 0 && this.div_.offsetWidth > this.maxWidth_) {\r\n\r\n        this.div_.style.width = this.maxWidth_;\r\n        this.div_.style.overflow = \"auto\";\r\n        this.fixedWidthSet_ = true;\r\n\r\n      } else { // The following code is needed to overcome problems with MSIE\r\n\r\n        bw = this.getBoxWidths_();\r\n\r\n        this.div_.style.width = (this.div_.offsetWidth - bw.left - bw.right) + \"px\";\r\n        this.fixedWidthSet_ = false;\r\n      }\r\n    }\r\n\r\n    this.panBox_(this.disableAutoPan_);\r\n\r\n    if (!this.enableEventPropagation_) {\r\n\r\n      this.eventListeners_ = [];\r\n\r\n      // Cancel event propagation.\r\n      //\r\n      // Note: mousemove not included (to resolve Issue 152)\r\n      events = [\"mousedown\", \"mouseover\", \"mouseout\", \"mouseup\",\r\n        \"click\", \"dblclick\", \"touchstart\", \"touchend\", \"touchmove\"];\r\n\r\n      for (i = 0; i < events.length; i++) {\r\n\r\n        this.eventListeners_.push(google.maps.event.addDomListener(this.div_, events[i], cancelHandler));\r\n      }\r\n\r\n      // Workaround for Google bug that causes the cursor to change to a pointer\r\n      // when the mouse moves over a marker underneath InfoBox.\r\n      this.eventListeners_.push(google.maps.event.addDomListener(this.div_, \"mouseover\", function (e) {\r\n        this.style.cursor = \"default\";\r\n      }));\r\n    }\r\n\r\n    this.contextListener_ = google.maps.event.addDomListener(this.div_, \"contextmenu\", ignoreHandler);\r\n\r\n    /**\r\n     * This event is fired when the DIV containing the InfoBox's content is attached to the DOM.\r\n     * @name InfoBox#domready\r\n     * @event\r\n     */\r\n    google.maps.event.trigger(this, \"domready\");\r\n  }\r\n};\r\n\r\n/**\r\n * Returns the HTML <IMG> tag for the close box.\r\n * @private\r\n */\r\nInfoBox.prototype.getCloseBoxImg_ = function () {\r\n\r\n  var img = \"\";\r\n\r\n  if (this.closeBoxURL_ !== \"\") {\r\n\r\n    img  = \"<img\";\r\n    img += \" src='\" + this.closeBoxURL_ + \"'\";\r\n    img += \" align=right\"; // Do this because Opera chokes on style='float: right;'\r\n    img += \" title='\" + this.closeBoxTitle_ + \"'\";\r\n    img += \" style='\";\r\n    img += \" position: relative;\"; // Required by MSIE\r\n    img += \" cursor: pointer;\";\r\n    img += \" margin: \" + this.closeBoxMargin_ + \";\";\r\n    img += \"'>\";\r\n  }\r\n\r\n  return img;\r\n};\r\n\r\n/**\r\n * Adds the click handler to the InfoBox close box.\r\n * @private\r\n */\r\nInfoBox.prototype.addClickHandler_ = function () {\r\n\r\n  var closeBox;\r\n\r\n  if (this.closeBoxURL_ !== \"\") {\r\n\r\n    closeBox = this.div_.firstChild;\r\n    this.closeListener_ = google.maps.event.addDomListener(closeBox, \"click\", this.getCloseClickHandler_());\r\n\r\n  } else {\r\n\r\n    this.closeListener_ = null;\r\n  }\r\n};\r\n\r\n/**\r\n * Returns the function to call when the user clicks the close box of an InfoBox.\r\n * @private\r\n */\r\nInfoBox.prototype.getCloseClickHandler_ = function () {\r\n\r\n  var me = this;\r\n\r\n  return function (e) {\r\n\r\n    // 1.0.3 fix: Always prevent propagation of a close box click to the map:\r\n    e.cancelBubble = true;\r\n\r\n    if (e.stopPropagation) {\r\n\r\n      e.stopPropagation();\r\n    }\r\n\r\n    /**\r\n     * This event is fired when the InfoBox's close box is clicked.\r\n     * @name InfoBox#closeclick\r\n     * @event\r\n     */\r\n    google.maps.event.trigger(me, \"closeclick\");\r\n\r\n    me.close();\r\n  };\r\n};\r\n\r\n/**\r\n * Pans the map so that the InfoBox appears entirely within the map's visible area.\r\n * @private\r\n */\r\nInfoBox.prototype.panBox_ = function (disablePan) {\r\n\r\n  var map;\r\n  var bounds;\r\n  var xOffset = 0, yOffset = 0;\r\n\r\n  if (!disablePan) {\r\n\r\n    map = this.getMap();\r\n\r\n    if (map instanceof google.maps.Map) { // Only pan if attached to map, not panorama\r\n\r\n      if (!map.getBounds().contains(this.position_)) {\r\n        // Marker not in visible area of map, so set center\r\n        // of map to the marker position first.\r\n        map.setCenter(this.position_);\r\n      }\r\n\r\n      var iwOffsetX = this.pixelOffset_.width;\r\n      var iwOffsetY = this.pixelOffset_.height;\r\n      var iwWidth = this.div_.offsetWidth;\r\n      var iwHeight = this.div_.offsetHeight;\r\n      var padX = this.infoBoxClearance_.width;\r\n      var padY = this.infoBoxClearance_.height;\r\n\r\n      if (map.panToBounds.length == 2) {\r\n        // Using projection.fromLatLngToContainerPixel to compute the infowindow position\r\n        // does not work correctly anymore for JS Maps API v3.32 and above if there is a\r\n        // previous synchronous call that causes the map to animate (e.g. setCenter when\r\n        // the position is not within bounds). Hence, we are using panToBounds with\r\n        // padding instead, which works synchronously.\r\n        var padding = {left: 0, right: 0, top: 0, bottom: 0};\r\n        padding.left = -iwOffsetX + padX;\r\n        padding.right = iwOffsetX + iwWidth + padX;\r\n        if (this.alignBottom_) {\r\n          padding.top = -iwOffsetY + padY + iwHeight;\r\n          padding.bottom = iwOffsetY + padY;\r\n        } else {\r\n          padding.top = -iwOffsetY + padY;\r\n          padding.bottom = iwOffsetY + iwHeight + padY;\r\n        }\r\n        map.panToBounds(new google.maps.LatLngBounds(this.position_), padding);\r\n      } else {\r\n        var mapDiv = map.getDiv();\r\n        var mapWidth = mapDiv.offsetWidth;\r\n        var mapHeight = mapDiv.offsetHeight;\r\n        var pixPosition = this.getProjection().fromLatLngToContainerPixel(this.position_);\r\n\r\n        if (pixPosition.x < (-iwOffsetX + padX)) {\r\n          xOffset = pixPosition.x + iwOffsetX - padX;\r\n        } else if ((pixPosition.x + iwWidth + iwOffsetX + padX) > mapWidth) {\r\n          xOffset = pixPosition.x + iwWidth + iwOffsetX + padX - mapWidth;\r\n        }\r\n        if (this.alignBottom_) {\r\n          if (pixPosition.y < (-iwOffsetY + padY + iwHeight)) {\r\n            yOffset = pixPosition.y + iwOffsetY - padY - iwHeight;\r\n          } else if ((pixPosition.y + iwOffsetY + padY) > mapHeight) {\r\n            yOffset = pixPosition.y + iwOffsetY + padY - mapHeight;\r\n          }\r\n        } else {\r\n          if (pixPosition.y < (-iwOffsetY + padY)) {\r\n            yOffset = pixPosition.y + iwOffsetY - padY;\r\n          } else if ((pixPosition.y + iwHeight + iwOffsetY + padY) > mapHeight) {\r\n            yOffset = pixPosition.y + iwHeight + iwOffsetY + padY - mapHeight;\r\n          }\r\n        }\r\n\r\n        if (!(xOffset === 0 && yOffset === 0)) {\r\n\r\n          // Move the map to the shifted center.\r\n          //\r\n          var c = map.getCenter();\r\n          map.panBy(xOffset, yOffset);\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Sets the style of the InfoBox by setting the style sheet and applying\r\n * other specific styles requested.\r\n * @private\r\n */\r\nInfoBox.prototype.setBoxStyle_ = function () {\r\n\r\n  var i, boxStyle;\r\n\r\n  if (this.div_) {\r\n\r\n    // Apply style values from the style sheet defined in the boxClass parameter:\r\n    this.div_.className = this.boxClass_;\r\n\r\n    // Clear existing inline style values:\r\n    this.div_.style.cssText = \"\";\r\n\r\n    // Apply style values defined in the boxStyle parameter:\r\n    boxStyle = this.boxStyle_;\r\n    for (i in boxStyle) {\r\n\r\n      if (boxStyle.hasOwnProperty(i)) {\r\n\r\n        this.div_.style[i] = boxStyle[i];\r\n      }\r\n    }\r\n\r\n    // Fix for iOS disappearing InfoBox problem.\r\n    // See http://stackoverflow.com/questions/9229535/google-maps-markers-disappear-at-certain-zoom-level-only-on-iphone-ipad\r\n    // Required: use \"matrix\" technique to specify transforms in order to avoid this bug.\r\n    if ((typeof this.div_.style.WebkitTransform === \"undefined\") || (this.div_.style.WebkitTransform.indexOf(\"translateZ\") === -1 && this.div_.style.WebkitTransform.indexOf(\"matrix\") === -1)) {\r\n\r\n      this.div_.style.WebkitTransform = \"translateZ(0)\";\r\n    }\r\n\r\n    // Fix up opacity style for benefit of MSIE:\r\n    //\r\n    if (typeof this.div_.style.opacity !== \"undefined\" && this.div_.style.opacity !== \"\") {\r\n      // See http://www.quirksmode.org/css/opacity.html\r\n      this.div_.style.MsFilter = \"\\\"progid:DXImageTransform.Microsoft.Alpha(Opacity=\" + (this.div_.style.opacity * 100) + \")\\\"\";\r\n      this.div_.style.filter = \"alpha(opacity=\" + (this.div_.style.opacity * 100) + \")\";\r\n    }\r\n\r\n    // Apply required styles:\r\n    //\r\n    this.div_.style.position = \"absolute\";\r\n    this.div_.style.visibility = 'hidden';\r\n    if (this.zIndex_ !== null) {\r\n\r\n      this.div_.style.zIndex = this.zIndex_;\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Get the widths of the borders of the InfoBox.\r\n * @private\r\n * @return {Object} widths object (top, bottom left, right)\r\n */\r\nInfoBox.prototype.getBoxWidths_ = function () {\r\n\r\n  var computedStyle;\r\n  var bw = {top: 0, bottom: 0, left: 0, right: 0};\r\n  var box = this.div_;\r\n\r\n  if (document.defaultView && document.defaultView.getComputedStyle) {\r\n\r\n    computedStyle = box.ownerDocument.defaultView.getComputedStyle(box, \"\");\r\n\r\n    if (computedStyle) {\r\n\r\n      // The computed styles are always in pixel units (good!)\r\n      bw.top = parseInt(computedStyle.borderTopWidth, 10) || 0;\r\n      bw.bottom = parseInt(computedStyle.borderBottomWidth, 10) || 0;\r\n      bw.left = parseInt(computedStyle.borderLeftWidth, 10) || 0;\r\n      bw.right = parseInt(computedStyle.borderRightWidth, 10) || 0;\r\n    }\r\n\r\n  } else if (document.documentElement.currentStyle) { // MSIE\r\n\r\n    if (box.currentStyle) {\r\n\r\n      // The current styles may not be in pixel units, but assume they are (bad!)\r\n      bw.top = parseInt(box.currentStyle.borderTopWidth, 10) || 0;\r\n      bw.bottom = parseInt(box.currentStyle.borderBottomWidth, 10) || 0;\r\n      bw.left = parseInt(box.currentStyle.borderLeftWidth, 10) || 0;\r\n      bw.right = parseInt(box.currentStyle.borderRightWidth, 10) || 0;\r\n    }\r\n  }\r\n\r\n  return bw;\r\n};\r\n\r\n/**\r\n * Invoked when <tt>close</tt> is called. Do not call it directly.\r\n */\r\nInfoBox.prototype.onRemove = function () {\r\n\r\n  if (this.div_) {\r\n\r\n    this.div_.parentNode.removeChild(this.div_);\r\n    this.div_ = null;\r\n  }\r\n};\r\n\r\n/**\r\n * Draws the InfoBox based on the current map projection and zoom level.\r\n */\r\nInfoBox.prototype.draw = function () {\r\n\r\n  this.createInfoBoxDiv_();\r\n\r\n  var pixPosition = this.getProjection().fromLatLngToDivPixel(this.position_);\r\n\r\n  this.div_.style.left = (pixPosition.x + this.pixelOffset_.width) + \"px\";\r\n\r\n  if (this.alignBottom_) {\r\n    this.div_.style.bottom = -(pixPosition.y + this.pixelOffset_.height) + \"px\";\r\n  } else {\r\n    this.div_.style.top = (pixPosition.y + this.pixelOffset_.height) + \"px\";\r\n  }\r\n\r\n  if (this.isHidden_) {\r\n\r\n    this.div_.style.visibility = \"hidden\";\r\n\r\n  } else {\r\n\r\n    this.div_.style.visibility = \"visible\";\r\n  }\r\n};\r\n\r\n/**\r\n * Sets the options for the InfoBox. Note that changes to the <tt>maxWidth</tt>,\r\n *  <tt>closeBoxMargin</tt>, <tt>closeBoxTitle</tt>, <tt>closeBoxURL</tt>, and\r\n *  <tt>enableEventPropagation</tt> properties have no affect until the current\r\n *  InfoBox is <tt>close</tt>d and a new one is <tt>open</tt>ed.\r\n * @param {InfoBoxOptions} opt_opts\r\n */\r\nInfoBox.prototype.setOptions = function (opt_opts) {\r\n  if (typeof opt_opts.boxClass !== \"undefined\") { // Must be first\r\n\r\n    this.boxClass_ = opt_opts.boxClass;\r\n    this.setBoxStyle_();\r\n  }\r\n  if (typeof opt_opts.boxStyle !== \"undefined\") { // Must be second\r\n\r\n    this.boxStyle_ = opt_opts.boxStyle;\r\n    this.setBoxStyle_();\r\n  }\r\n  if (typeof opt_opts.content !== \"undefined\") {\r\n\r\n    this.setContent(opt_opts.content);\r\n  }\r\n  if (typeof opt_opts.disableAutoPan !== \"undefined\") {\r\n\r\n    this.disableAutoPan_ = opt_opts.disableAutoPan;\r\n  }\r\n  if (typeof opt_opts.maxWidth !== \"undefined\") {\r\n\r\n    this.maxWidth_ = opt_opts.maxWidth;\r\n  }\r\n  if (typeof opt_opts.pixelOffset !== \"undefined\") {\r\n\r\n    this.pixelOffset_ = opt_opts.pixelOffset;\r\n  }\r\n  if (typeof opt_opts.alignBottom !== \"undefined\") {\r\n\r\n    this.alignBottom_ = opt_opts.alignBottom;\r\n  }\r\n  if (typeof opt_opts.position !== \"undefined\") {\r\n\r\n    this.setPosition(opt_opts.position);\r\n  }\r\n  if (typeof opt_opts.zIndex !== \"undefined\") {\r\n\r\n    this.setZIndex(opt_opts.zIndex);\r\n  }\r\n  if (typeof opt_opts.closeBoxMargin !== \"undefined\") {\r\n\r\n    this.closeBoxMargin_ = opt_opts.closeBoxMargin;\r\n  }\r\n  if (typeof opt_opts.closeBoxURL !== \"undefined\") {\r\n\r\n    this.closeBoxURL_ = opt_opts.closeBoxURL;\r\n  }\r\n  if (typeof opt_opts.closeBoxTitle !== \"undefined\") {\r\n\r\n    this.closeBoxTitle_ = opt_opts.closeBoxTitle;\r\n  }\r\n  if (typeof opt_opts.infoBoxClearance !== \"undefined\") {\r\n\r\n    this.infoBoxClearance_ = opt_opts.infoBoxClearance;\r\n  }\r\n  if (typeof opt_opts.isHidden !== \"undefined\") {\r\n\r\n    this.isHidden_ = opt_opts.isHidden;\r\n  }\r\n  if (typeof opt_opts.visible !== \"undefined\") {\r\n\r\n    this.isHidden_ = !opt_opts.visible;\r\n  }\r\n  if (typeof opt_opts.enableEventPropagation !== \"undefined\") {\r\n\r\n    this.enableEventPropagation_ = opt_opts.enableEventPropagation;\r\n  }\r\n\r\n  if (this.div_) {\r\n\r\n    this.draw();\r\n  }\r\n};\r\n\r\n/**\r\n * Sets the content of the InfoBox.\r\n *  The content can be plain text or an HTML DOM node.\r\n * @param {string|Node} content\r\n */\r\nInfoBox.prototype.setContent = function (content) {\r\n  this.content_ = content;\r\n\r\n  if (this.div_) {\r\n\r\n    if (this.closeListener_) {\r\n\r\n      google.maps.event.removeListener(this.closeListener_);\r\n      this.closeListener_ = null;\r\n    }\r\n\r\n    // Odd code required to make things work with MSIE.\r\n    //\r\n    if (!this.fixedWidthSet_) {\r\n\r\n      this.div_.style.width = \"\";\r\n    }\r\n\r\n    if (typeof content.nodeType === \"undefined\") {\r\n      this.div_.innerHTML = this.getCloseBoxImg_() + content;\r\n    } else {\r\n      this.div_.innerHTML = this.getCloseBoxImg_();\r\n      this.div_.appendChild(content);\r\n    }\r\n\r\n    // Perverse code required to make things work with MSIE.\r\n    // (Ensures the close box does, in fact, float to the right.)\r\n    //\r\n    if (!this.fixedWidthSet_) {\r\n      this.div_.style.width = this.div_.offsetWidth + \"px\";\r\n      if (typeof content.nodeType === \"undefined\") {\r\n        this.div_.innerHTML = this.getCloseBoxImg_() + content;\r\n      } else {\r\n        this.div_.innerHTML = this.getCloseBoxImg_();\r\n        this.div_.appendChild(content);\r\n      }\r\n    }\r\n\r\n    this.addClickHandler_();\r\n  }\r\n\r\n  /**\r\n   * This event is fired when the content of the InfoBox changes.\r\n   * @name InfoBox#content_changed\r\n   * @event\r\n   */\r\n  google.maps.event.trigger(this, \"content_changed\");\r\n};\r\n\r\n/**\r\n * Sets the geographic location of the InfoBox.\r\n * @param {LatLng} latlng\r\n */\r\nInfoBox.prototype.setPosition = function (latlng) {\r\n\r\n  this.position_ = latlng;\r\n\r\n  if (this.div_) {\r\n\r\n    this.draw();\r\n  }\r\n\r\n  /**\r\n   * This event is fired when the position of the InfoBox changes.\r\n   * @name InfoBox#position_changed\r\n   * @event\r\n   */\r\n  google.maps.event.trigger(this, \"position_changed\");\r\n};\r\n\r\n/**\r\n * Sets the zIndex style for the InfoBox.\r\n * @param {number} index\r\n */\r\nInfoBox.prototype.setZIndex = function (index) {\r\n\r\n  this.zIndex_ = index;\r\n\r\n  if (this.div_) {\r\n\r\n    this.div_.style.zIndex = index;\r\n  }\r\n\r\n  /**\r\n   * This event is fired when the zIndex of the InfoBox changes.\r\n   * @name InfoBox#zindex_changed\r\n   * @event\r\n   */\r\n  google.maps.event.trigger(this, \"zindex_changed\");\r\n};\r\n\r\n/**\r\n * Sets the visibility of the InfoBox.\r\n * @param {boolean} isVisible\r\n */\r\nInfoBox.prototype.setVisible = function (isVisible) {\r\n\r\n  this.isHidden_ = !isVisible;\r\n  if (this.div_) {\r\n    this.div_.style.visibility = (this.isHidden_ ? \"hidden\" : \"visible\");\r\n  }\r\n};\r\n\r\n/**\r\n * Returns the content of the InfoBox.\r\n * @returns {string}\r\n */\r\nInfoBox.prototype.getContent = function () {\r\n\r\n  return this.content_;\r\n};\r\n\r\n/**\r\n * Returns the geographic location of the InfoBox.\r\n * @returns {LatLng}\r\n */\r\nInfoBox.prototype.getPosition = function () {\r\n\r\n  return this.position_;\r\n};\r\n\r\n/**\r\n * Returns the zIndex for the InfoBox.\r\n * @returns {number}\r\n */\r\nInfoBox.prototype.getZIndex = function () {\r\n\r\n  return this.zIndex_;\r\n};\r\n\r\n/**\r\n * Returns a flag indicating whether the InfoBox is visible.\r\n * @returns {boolean}\r\n */\r\nInfoBox.prototype.getVisible = function () {\r\n\r\n  var isVisible;\r\n\r\n  if ((typeof this.getMap() === \"undefined\") || (this.getMap() === null)) {\r\n    isVisible = false;\r\n  } else {\r\n    isVisible = !this.isHidden_;\r\n  }\r\n  return isVisible;\r\n};\r\n\r\n/**\r\n * Returns the width of the InfoBox in pixels.\r\n * @returns {number}\r\n */\r\nInfoBox.prototype.getWidth = function () {\r\n  var width = null;\r\n\r\n  if (this.div_) {\r\n    width = this.div_.offsetWidth;\r\n  }\r\n\r\n  return width;\r\n};\r\n\r\n/**\r\n * Returns the height of the InfoBox in pixels.\r\n * @returns {number}\r\n */\r\nInfoBox.prototype.getHeight = function () {\r\n  var height = null;\r\n\r\n  if (this.div_) {\r\n    height = this.div_.offsetHeight;\r\n  }\r\n\r\n  return height;\r\n};\r\n\r\n/**\r\n * Shows the InfoBox. [Deprecated; use <tt>setVisible</tt> instead.]\r\n */\r\nInfoBox.prototype.show = function () {\r\n\r\n  this.isHidden_ = false;\r\n  if (this.div_) {\r\n    this.div_.style.visibility = \"visible\";\r\n  }\r\n};\r\n\r\n/**\r\n * Hides the InfoBox. [Deprecated; use <tt>setVisible</tt> instead.]\r\n */\r\nInfoBox.prototype.hide = function () {\r\n\r\n  this.isHidden_ = true;\r\n  if (this.div_) {\r\n    this.div_.style.visibility = \"hidden\";\r\n  }\r\n};\r\n\r\n/**\r\n * Adds the InfoBox to the specified map or Street View panorama. If <tt>anchor</tt>\r\n *  (usually a <tt>google.maps.Marker</tt>) is specified, the position\r\n *  of the InfoBox is set to the position of the <tt>anchor</tt>. If the\r\n *  anchor is dragged to a new location, the InfoBox moves as well.\r\n * @param {Map|StreetViewPanorama} map\r\n * @param {MVCObject} [anchor]\r\n */\r\nInfoBox.prototype.open = function (map, anchor) {\r\n\r\n  var me = this;\r\n\r\n  if (anchor) {\r\n\r\n    this.setPosition(anchor.getPosition()); // BUG FIX 2/17/2018: needed for v3.32\r\n    this.moveListener_ = google.maps.event.addListener(anchor, \"position_changed\", function () {\r\n      me.setPosition(this.getPosition());\r\n    });\r\n  }\r\n\r\n  this.setMap(map);\r\n\r\n  if (this.div_) {\r\n\r\n    this.panBox_(this.disableAutoPan_); // BUG FIX 2/17/2018: add missing parameter\r\n  }\r\n};\r\n\r\n/**\r\n * Removes the InfoBox from the map.\r\n */\r\nInfoBox.prototype.close = function () {\r\n\r\n  var i;\r\n\r\n  if (this.closeListener_) {\r\n\r\n    google.maps.event.removeListener(this.closeListener_);\r\n    this.closeListener_ = null;\r\n  }\r\n\r\n  if (this.eventListeners_) {\r\n\r\n    for (i = 0; i < this.eventListeners_.length; i++) {\r\n\r\n      google.maps.event.removeListener(this.eventListeners_[i]);\r\n    }\r\n    this.eventListeners_ = null;\r\n  }\r\n\r\n  if (this.moveListener_) {\r\n\r\n    google.maps.event.removeListener(this.moveListener_);\r\n    this.moveListener_ = null;\r\n  }\r\n\r\n  if (this.contextListener_) {\r\n\r\n    google.maps.event.removeListener(this.contextListener_);\r\n    this.contextListener_ = null;\r\n  }\r\n\r\n  this.setMap(null);\r\n};\r\n\r\n\r\n// ==ClosureCompiler==\r\n// @compilation_level ADVANCED_OPTIMIZATIONS\r\n// @externs_url https://raw.githubusercontent.com/google/closure-compiler/master/contrib/externs/maps/google_maps_api_v3.js\r\n// ==/ClosureCompiler==\r\n\r\n/**\r\n * @name MarkerClusterer for Google Maps v3\r\n * @version version 1.0\r\n * @author Luke Mahe\r\n * @fileoverview\r\n * The library creates and manages per-zoom-level clusters for large amounts of\r\n * markers.\r\n * <br/>\r\n * This is a v3 implementation of the\r\n * <a href=\"http://gmaps-utility-library-dev.googlecode.com/svn/tags/markerclusterer/\"\r\n * >v2 MarkerClusterer</a>.\r\n */\r\n\r\n/**\r\n * @license\r\n * Copyright 2010 Google Inc. All Rights Reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n\r\n/**\r\n * A Marker Clusterer that clusters markers.\r\n *\r\n * @param {google.maps.Map} map The Google map to attach to.\r\n * @param {Array.<google.maps.Marker>=} opt_markers Optional markers to add to\r\n *   the cluster.\r\n * @param {Object=} opt_options support the following options:\r\n *     'gridSize': (number) The grid size of a cluster in pixels.\r\n *     'maxZoom': (number) The maximum zoom level that a marker can be part of a\r\n *                cluster.\r\n *     'zoomOnClick': (boolean) Whether the default behaviour of clicking on a\r\n *                    cluster is to zoom into it.\r\n *     'averageCenter': (boolean) Whether the center of each cluster should be\r\n *                      the average of all markers in the cluster.\r\n *     'minimumClusterSize': (number) The minimum number of markers to be in a\r\n *                           cluster before the markers are hidden and a count\r\n *                           is shown.\r\n *     'styles': (object) An object that has style properties:\r\n *       'url': (string) The image url.\r\n *       'height': (number) The image height.\r\n *       'width': (number) The image width.\r\n *       'anchor': (Array) The anchor position of the label text.\r\n *       'textColor': (string) The text color.\r\n *       'textSize': (number) The text size.\r\n *       'backgroundPosition': (string) The position of the backgound x, y.\r\n *       'iconAnchor': (Array) The anchor position of the icon x, y.\r\n * @constructor\r\n * @extends google.maps.OverlayView\r\n */\r\nfunction MarkerClusterer(map, opt_markers, opt_options) {\r\n  // MarkerClusterer implements google.maps.OverlayView interface. We use the\r\n  // extend function to extend MarkerClusterer with google.maps.OverlayView\r\n  // because it might not always be available when the code is defined so we\r\n  // look for it at the last possible moment. If it doesn't exist now then\r\n  // there is no point going ahead :)\r\n  this.extend(MarkerClusterer, google.maps.OverlayView);\r\n  this.map_ = map;\r\n\r\n  /**\r\n   * @type {Array.<google.maps.Marker>}\r\n   * @private\r\n   */\r\n  this.markers_ = [];\r\n\r\n  /**\r\n   *  @type {Array.<Cluster>}\r\n   */\r\n  this.clusters_ = [];\r\n\r\n  this.sizes = [53, 56, 66, 78, 90];\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.styles_ = [];\r\n\r\n  /**\r\n   * @type {boolean}\r\n   * @private\r\n   */\r\n  this.ready_ = false;\r\n\r\n  var options = opt_options || {};\r\n\r\n  /**\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  this.gridSize_ = options['gridSize'] || 60;\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  this.minClusterSize_ = options['minimumClusterSize'] || 2;\r\n\r\n\r\n  /**\r\n   * @type {?number}\r\n   * @private\r\n   */\r\n  this.maxZoom_ = options['maxZoom'] || null;\r\n\r\n  this.styles_ = options['styles'] || [];\r\n\r\n  /**\r\n   * @type {string}\r\n   * @private\r\n   */\r\n  this.imagePath_ = options['imagePath'] ||\r\n      this.MARKER_CLUSTER_IMAGE_PATH_;\r\n\r\n  /**\r\n   * @type {string}\r\n   * @private\r\n   */\r\n  this.imageExtension_ = options['imageExtension'] ||\r\n      this.MARKER_CLUSTER_IMAGE_EXTENSION_;\r\n\r\n  /**\r\n   * @type {boolean}\r\n   * @private\r\n   */\r\n  this.zoomOnClick_ = true;\r\n\r\n  if (options['zoomOnClick'] != undefined) {\r\n    this.zoomOnClick_ = options['zoomOnClick'];\r\n  }\r\n\r\n  /**\r\n   * @type {boolean}\r\n   * @private\r\n   */\r\n  this.averageCenter_ = false;\r\n\r\n  if (options['averageCenter'] != undefined) {\r\n    this.averageCenter_ = options['averageCenter'];\r\n  }\r\n\r\n  this.setupStyles_();\r\n\r\n  this.setMap(map);\r\n\r\n  /**\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  this.prevZoom_ = this.map_.getZoom();\r\n\r\n  // Add the map event listeners\r\n  var that = this;\r\n  google.maps.event.addListener(this.map_, 'zoom_changed', function() {\r\n    var zoom = that.map_.getZoom();\r\n\r\n    if (that.prevZoom_ != zoom) {\r\n      that.prevZoom_ = zoom;\r\n      that.resetViewport();\r\n    }\r\n  });\r\n\r\n  google.maps.event.addListener(this.map_, 'idle', function() {\r\n    that.redraw();\r\n  });\r\n\r\n  // Finally, add the markers\r\n  if (opt_markers && opt_markers.length) {\r\n    this.addMarkers(opt_markers, false);\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * The marker cluster image path.\r\n *\r\n * @type {string}\r\n * @private\r\n */\r\nMarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_PATH_ = '../images/m';\r\n\r\n\r\n/**\r\n * The marker cluster image path.\r\n *\r\n * @type {string}\r\n * @private\r\n */\r\nMarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_EXTENSION_ = 'png';\r\n\r\n\r\n/**\r\n * Extends a objects prototype by anothers.\r\n *\r\n * @param {Object} obj1 The object to be extended.\r\n * @param {Object} obj2 The object to extend with.\r\n * @return {Object} The new extended object.\r\n * @ignore\r\n */\r\nMarkerClusterer.prototype.extend = function(obj1, obj2) {\r\n  return (function(object) {\r\n    for (var property in object.prototype) {\r\n      this.prototype[property] = object.prototype[property];\r\n    }\r\n    return this;\r\n  }).apply(obj1, [obj2]);\r\n};\r\n\r\n\r\n/**\r\n * Implementaion of the interface method.\r\n * @ignore\r\n */\r\nMarkerClusterer.prototype.onAdd = function() {\r\n  this.setReady_(true);\r\n};\r\n\r\n/**\r\n * Implementaion of the interface method.\r\n * @ignore\r\n */\r\nMarkerClusterer.prototype.draw = function() {};\r\n\r\n/**\r\n * Sets up the styles object.\r\n *\r\n * @private\r\n */\r\nMarkerClusterer.prototype.setupStyles_ = function() {\r\n  if (this.styles_.length) {\r\n    return;\r\n  }\r\n\r\n  for (var i = 0, size; size = this.sizes[i]; i++) {\r\n    this.styles_.push({\r\n      url: this.imagePath_ + (i + 1) + '.' + this.imageExtension_,\r\n      height: size,\r\n      width: size\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n *  Fit the map to the bounds of the markers in the clusterer.\r\n */\r\nMarkerClusterer.prototype.fitMapToMarkers = function() {\r\n  var markers = this.getMarkers();\r\n  var bounds = new google.maps.LatLngBounds();\r\n  for (var i = 0, marker; marker = markers[i]; i++) {\r\n    bounds.extend(marker.getPosition());\r\n  }\r\n\r\n  this.map_.fitBounds(bounds);\r\n};\r\n\r\n\r\n/**\r\n *  Sets the styles.\r\n *\r\n *  @param {Object} styles The style to set.\r\n */\r\nMarkerClusterer.prototype.setStyles = function(styles) {\r\n  this.styles_ = styles;\r\n};\r\n\r\n\r\n/**\r\n *  Gets the styles.\r\n *\r\n *  @return {Object} The styles object.\r\n */\r\nMarkerClusterer.prototype.getStyles = function() {\r\n  return this.styles_;\r\n};\r\n\r\n\r\n/**\r\n * Whether zoom on click is set.\r\n *\r\n * @return {boolean} True if zoomOnClick_ is set.\r\n */\r\nMarkerClusterer.prototype.isZoomOnClick = function() {\r\n  return this.zoomOnClick_;\r\n};\r\n\r\n/**\r\n * Whether average center is set.\r\n *\r\n * @return {boolean} True if averageCenter_ is set.\r\n */\r\nMarkerClusterer.prototype.isAverageCenter = function() {\r\n  return this.averageCenter_;\r\n};\r\n\r\n\r\n/**\r\n *  Returns the array of markers in the clusterer.\r\n *\r\n *  @return {Array.<google.maps.Marker>} The markers.\r\n */\r\nMarkerClusterer.prototype.getMarkers = function() {\r\n  return this.markers_;\r\n};\r\n\r\n\r\n/**\r\n *  Returns the number of markers in the clusterer\r\n *\r\n *  @return {Number} The number of markers.\r\n */\r\nMarkerClusterer.prototype.getTotalMarkers = function() {\r\n  return this.markers_.length;\r\n};\r\n\r\n\r\n/**\r\n *  Sets the max zoom for the clusterer.\r\n *\r\n *  @param {number} maxZoom The max zoom level.\r\n */\r\nMarkerClusterer.prototype.setMaxZoom = function(maxZoom) {\r\n  this.maxZoom_ = maxZoom;\r\n};\r\n\r\n\r\n/**\r\n *  Gets the max zoom for the clusterer.\r\n *\r\n *  @return {number} The max zoom level.\r\n */\r\nMarkerClusterer.prototype.getMaxZoom = function() {\r\n  return this.maxZoom_;\r\n};\r\n\r\n\r\n/**\r\n *  The function for calculating the cluster icon image.\r\n *\r\n *  @param {Array.<google.maps.Marker>} markers The markers in the clusterer.\r\n *  @param {number} numStyles The number of styles available.\r\n *  @return {Object} A object properties: 'text' (string) and 'index' (number).\r\n *  @private\r\n */\r\nMarkerClusterer.prototype.calculator_ = function(markers, numStyles) {\r\n  var index = 0;\r\n  var count = markers.length;\r\n  var dv = count;\r\n  while (dv !== 0) {\r\n    dv = parseInt(dv / 10, 10);\r\n    index++;\r\n  }\r\n\r\n  index = Math.min(index, numStyles);\r\n  return {\r\n    text: count,\r\n    index: index\r\n  };\r\n};\r\n\r\n\r\n/**\r\n * Set the calculator function.\r\n *\r\n * @param {function(Array, number)} calculator The function to set as the\r\n *     calculator. The function should return a object properties:\r\n *     'text' (string) and 'index' (number).\r\n *\r\n */\r\nMarkerClusterer.prototype.setCalculator = function(calculator) {\r\n  this.calculator_ = calculator;\r\n};\r\n\r\n\r\n/**\r\n * Get the calculator function.\r\n *\r\n * @return {function(Array, number)} the calculator function.\r\n */\r\nMarkerClusterer.prototype.getCalculator = function() {\r\n  return this.calculator_;\r\n};\r\n\r\n\r\n/**\r\n * Add an array of markers to the clusterer.\r\n *\r\n * @param {Array.<google.maps.Marker>} markers The markers to add.\r\n * @param {boolean=} opt_nodraw Whether to redraw the clusters.\r\n */\r\nMarkerClusterer.prototype.addMarkers = function(markers, opt_nodraw) {\r\n  for (var i = 0, marker; marker = markers[i]; i++) {\r\n    this.pushMarkerTo_(marker);\r\n  }\r\n  if (!opt_nodraw) {\r\n    this.redraw();\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Pushes a marker to the clusterer.\r\n *\r\n * @param {google.maps.Marker} marker The marker to add.\r\n * @private\r\n */\r\nMarkerClusterer.prototype.pushMarkerTo_ = function(marker) {\r\n  marker.isAdded = false;\r\n  if (marker['draggable']) {\r\n    // If the marker is draggable add a listener so we update the clusters on\r\n    // the drag end.\r\n    var that = this;\r\n    google.maps.event.addListener(marker, 'dragend', function() {\r\n      marker.isAdded = false;\r\n      that.repaint();\r\n    });\r\n  }\r\n  this.markers_.push(marker);\r\n};\r\n\r\n\r\n/**\r\n * Adds a marker to the clusterer and redraws if needed.\r\n *\r\n * @param {google.maps.Marker} marker The marker to add.\r\n * @param {boolean=} opt_nodraw Whether to redraw the clusters.\r\n */\r\nMarkerClusterer.prototype.addMarker = function(marker, opt_nodraw) {\r\n  this.pushMarkerTo_(marker);\r\n  if (!opt_nodraw) {\r\n    this.redraw();\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Removes a marker and returns true if removed, false if not\r\n *\r\n * @param {google.maps.Marker} marker The marker to remove\r\n * @return {boolean} Whether the marker was removed or not\r\n * @private\r\n */\r\nMarkerClusterer.prototype.removeMarker_ = function(marker) {\r\n  var index = -1;\r\n  if (this.markers_.indexOf) {\r\n    index = this.markers_.indexOf(marker);\r\n  } else {\r\n    for (var i = 0, m; m = this.markers_[i]; i++) {\r\n      if (m == marker) {\r\n        index = i;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (index == -1) {\r\n    // Marker is not in our list of markers.\r\n    return false;\r\n  }\r\n\r\n  marker.setMap(null);\r\n\r\n  this.markers_.splice(index, 1);\r\n\r\n  return true;\r\n};\r\n\r\n\r\n/**\r\n * Remove a marker from the cluster.\r\n *\r\n * @param {google.maps.Marker} marker The marker to remove.\r\n * @param {boolean=} opt_nodraw Optional boolean to force no redraw.\r\n * @return {boolean} True if the marker was removed.\r\n */\r\nMarkerClusterer.prototype.removeMarker = function(marker, opt_nodraw) {\r\n  var removed = this.removeMarker_(marker);\r\n\r\n  if (!opt_nodraw && removed) {\r\n    this.resetViewport();\r\n    this.redraw();\r\n    return true;\r\n  } else {\r\n   return false;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Removes an array of markers from the cluster.\r\n *\r\n * @param {Array.<google.maps.Marker>} markers The markers to remove.\r\n * @param {boolean=} opt_nodraw Optional boolean to force no redraw.\r\n */\r\nMarkerClusterer.prototype.removeMarkers = function(markers, opt_nodraw) {\r\n  var removed = false;\r\n\r\n  for (var i = 0, marker; marker = markers[i]; i++) {\r\n    var r = this.removeMarker_(marker);\r\n    removed = removed || r;\r\n  }\r\n\r\n  if (!opt_nodraw && removed) {\r\n    this.resetViewport();\r\n    this.redraw();\r\n    return true;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Sets the clusterer's ready state.\r\n *\r\n * @param {boolean} ready The state.\r\n * @private\r\n */\r\nMarkerClusterer.prototype.setReady_ = function(ready) {\r\n  if (!this.ready_) {\r\n    this.ready_ = ready;\r\n    this.createClusters_();\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Returns the number of clusters in the clusterer.\r\n *\r\n * @return {number} The number of clusters.\r\n */\r\nMarkerClusterer.prototype.getTotalClusters = function() {\r\n  return this.clusters_.length;\r\n};\r\n\r\n\r\n/**\r\n * Returns the google map that the clusterer is associated with.\r\n *\r\n * @return {google.maps.Map} The map.\r\n */\r\nMarkerClusterer.prototype.getMap = function() {\r\n  return this.map_;\r\n};\r\n\r\n\r\n/**\r\n * Sets the google map that the clusterer is associated with.\r\n *\r\n * @param {google.maps.Map} map The map.\r\n */\r\nMarkerClusterer.prototype.setMap = function(map) {\r\n  this.map_ = map;\r\n};\r\n\r\n\r\n/**\r\n * Returns the size of the grid.\r\n *\r\n * @return {number} The grid size.\r\n */\r\nMarkerClusterer.prototype.getGridSize = function() {\r\n  return this.gridSize_;\r\n};\r\n\r\n\r\n/**\r\n * Sets the size of the grid.\r\n *\r\n * @param {number} size The grid size.\r\n */\r\nMarkerClusterer.prototype.setGridSize = function(size) {\r\n  this.gridSize_ = size;\r\n};\r\n\r\n\r\n/**\r\n * Returns the min cluster size.\r\n *\r\n * @return {number} The grid size.\r\n */\r\nMarkerClusterer.prototype.getMinClusterSize = function() {\r\n  return this.minClusterSize_;\r\n};\r\n\r\n/**\r\n * Sets the min cluster size.\r\n *\r\n * @param {number} size The grid size.\r\n */\r\nMarkerClusterer.prototype.setMinClusterSize = function(size) {\r\n  this.minClusterSize_ = size;\r\n};\r\n\r\n\r\n/**\r\n * Extends a bounds object by the grid size.\r\n *\r\n * @param {google.maps.LatLngBounds} bounds The bounds to extend.\r\n * @return {google.maps.LatLngBounds} The extended bounds.\r\n */\r\nMarkerClusterer.prototype.getExtendedBounds = function(bounds) {\r\n  var projection = this.getProjection();\r\n\r\n  // Turn the bounds into latlng.\r\n  var tr = new google.maps.LatLng(bounds.getNorthEast().lat(),\r\n      bounds.getNorthEast().lng());\r\n  var bl = new google.maps.LatLng(bounds.getSouthWest().lat(),\r\n      bounds.getSouthWest().lng());\r\n\r\n  // Convert the points to pixels and the extend out by the grid size.\r\n  var trPix = projection.fromLatLngToDivPixel(tr);\r\n  trPix.x += this.gridSize_;\r\n  trPix.y -= this.gridSize_;\r\n\r\n  var blPix = projection.fromLatLngToDivPixel(bl);\r\n  blPix.x -= this.gridSize_;\r\n  blPix.y += this.gridSize_;\r\n\r\n  // Convert the pixel points back to LatLng\r\n  var ne = projection.fromDivPixelToLatLng(trPix);\r\n  var sw = projection.fromDivPixelToLatLng(blPix);\r\n\r\n  // Extend the bounds to contain the new bounds.\r\n  bounds.extend(ne);\r\n  bounds.extend(sw);\r\n\r\n  return bounds;\r\n};\r\n\r\n\r\n/**\r\n * Determins if a marker is contained in a bounds.\r\n *\r\n * @param {google.maps.Marker} marker The marker to check.\r\n * @param {google.maps.LatLngBounds} bounds The bounds to check against.\r\n * @return {boolean} True if the marker is in the bounds.\r\n * @private\r\n */\r\nMarkerClusterer.prototype.isMarkerInBounds_ = function(marker, bounds) {\r\n  return bounds.contains(marker.getPosition());\r\n};\r\n\r\n\r\n/**\r\n * Clears all clusters and markers from the clusterer.\r\n */\r\nMarkerClusterer.prototype.clearMarkers = function() {\r\n  this.resetViewport(true);\r\n\r\n  // Set the markers a empty array.\r\n  this.markers_ = [];\r\n};\r\n\r\n\r\n/**\r\n * Clears all existing clusters and recreates them.\r\n * @param {boolean} opt_hide To also hide the marker.\r\n */\r\nMarkerClusterer.prototype.resetViewport = function(opt_hide) {\r\n  // Remove all the clusters\r\n  for (var i = 0, cluster; cluster = this.clusters_[i]; i++) {\r\n    cluster.remove();\r\n  }\r\n\r\n  // Reset the markers to not be added and to be invisible.\r\n  for (var i = 0, marker; marker = this.markers_[i]; i++) {\r\n    marker.isAdded = false;\r\n    if (opt_hide) {\r\n      marker.setMap(null);\r\n    }\r\n  }\r\n\r\n  this.clusters_ = [];\r\n};\r\n\r\n/**\r\n *\r\n */\r\nMarkerClusterer.prototype.repaint = function() {\r\n  var oldClusters = this.clusters_.slice();\r\n  this.clusters_.length = 0;\r\n  this.resetViewport();\r\n  this.redraw();\r\n\r\n  // Remove the old clusters.\r\n  // Do it in a timeout so the other clusters have been drawn first.\r\n  window.setTimeout(function() {\r\n    for (var i = 0, cluster; cluster = oldClusters[i]; i++) {\r\n      cluster.remove();\r\n    }\r\n  }, 0);\r\n};\r\n\r\n\r\n/**\r\n * Redraws the clusters.\r\n */\r\nMarkerClusterer.prototype.redraw = function() {\r\n  this.createClusters_();\r\n};\r\n\r\n\r\n/**\r\n * Calculates the distance between two latlng locations in km.\r\n * @see http://www.movable-type.co.uk/scripts/latlong.html\r\n *\r\n * @param {google.maps.LatLng} p1 The first lat lng point.\r\n * @param {google.maps.LatLng} p2 The second lat lng point.\r\n * @return {number} The distance between the two points in km.\r\n * @private\r\n*/\r\nMarkerClusterer.prototype.distanceBetweenPoints_ = function(p1, p2) {\r\n  if (!p1 || !p2) {\r\n    return 0;\r\n  }\r\n\r\n  var R = 6371; // Radius of the Earth in km\r\n  var dLat = (p2.lat() - p1.lat()) * Math.PI / 180;\r\n  var dLon = (p2.lng() - p1.lng()) * Math.PI / 180;\r\n  var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n    Math.cos(p1.lat() * Math.PI / 180) * Math.cos(p2.lat() * Math.PI / 180) *\r\n    Math.sin(dLon / 2) * Math.sin(dLon / 2);\r\n  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n  var d = R * c;\r\n  return d;\r\n};\r\n\r\n\r\n/**\r\n * Add a marker to a cluster, or creates a new cluster.\r\n *\r\n * @param {google.maps.Marker} marker The marker to add.\r\n * @private\r\n */\r\nMarkerClusterer.prototype.addToClosestCluster_ = function(marker) {\r\n  var distance = 40000; // Some large number\r\n  var clusterToAddTo = null;\r\n  var pos = marker.getPosition();\r\n  for (var i = 0, cluster; cluster = this.clusters_[i]; i++) {\r\n    var center = cluster.getCenter();\r\n    if (center) {\r\n      var d = this.distanceBetweenPoints_(center, marker.getPosition());\r\n      if (d < distance) {\r\n        distance = d;\r\n        clusterToAddTo = cluster;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (clusterToAddTo && clusterToAddTo.isMarkerInClusterBounds(marker)) {\r\n    clusterToAddTo.addMarker(marker);\r\n  } else {\r\n    var cluster = new Cluster(this);\r\n    cluster.addMarker(marker);\r\n    this.clusters_.push(cluster);\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Creates the clusters.\r\n *\r\n * @private\r\n */\r\nMarkerClusterer.prototype.createClusters_ = function() {\r\n  if (!this.ready_) {\r\n    return;\r\n  }\r\n\r\n  // Get our current map view bounds.\r\n  // Create a new bounds object so we don't affect the map.\r\n  var mapBounds = new google.maps.LatLngBounds(this.map_.getBounds().getSouthWest(),\r\n      this.map_.getBounds().getNorthEast());\r\n  var bounds = this.getExtendedBounds(mapBounds);\r\n\r\n  for (var i = 0, marker; marker = this.markers_[i]; i++) {\r\n    if (!marker.isAdded && this.isMarkerInBounds_(marker, bounds)) {\r\n      this.addToClosestCluster_(marker);\r\n    }\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * A cluster that contains markers.\r\n *\r\n * @param {MarkerClusterer} markerClusterer The markerclusterer that this\r\n *     cluster is associated with.\r\n * @constructor\r\n * @ignore\r\n */\r\nfunction Cluster(markerClusterer) {\r\n  this.markerClusterer_ = markerClusterer;\r\n  this.map_ = markerClusterer.getMap();\r\n  this.gridSize_ = markerClusterer.getGridSize();\r\n  this.minClusterSize_ = markerClusterer.getMinClusterSize();\r\n  this.averageCenter_ = markerClusterer.isAverageCenter();\r\n  this.center_ = null;\r\n  this.markers_ = [];\r\n  this.bounds_ = null;\r\n  this.clusterIcon_ = new ClusterIcon(this, markerClusterer.getStyles(),\r\n      markerClusterer.getGridSize());\r\n}\r\n\r\n/**\r\n * Determins if a marker is already added to the cluster.\r\n *\r\n * @param {google.maps.Marker} marker The marker to check.\r\n * @return {boolean} True if the marker is already added.\r\n */\r\nCluster.prototype.isMarkerAlreadyAdded = function(marker) {\r\n  if (this.markers_.indexOf) {\r\n    return this.markers_.indexOf(marker) != -1;\r\n  } else {\r\n    for (var i = 0, m; m = this.markers_[i]; i++) {\r\n      if (m == marker) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\n\r\n/**\r\n * Add a marker the cluster.\r\n *\r\n * @param {google.maps.Marker} marker The marker to add.\r\n * @return {boolean} True if the marker was added.\r\n */\r\nCluster.prototype.addMarker = function(marker) {\r\n  if (this.isMarkerAlreadyAdded(marker)) {\r\n    return false;\r\n  }\r\n\r\n  if (!this.center_) {\r\n    this.center_ = marker.getPosition();\r\n    this.calculateBounds_();\r\n  } else {\r\n    if (this.averageCenter_) {\r\n      var l = this.markers_.length + 1;\r\n      var lat = (this.center_.lat() * (l-1) + marker.getPosition().lat()) / l;\r\n      var lng = (this.center_.lng() * (l-1) + marker.getPosition().lng()) / l;\r\n      this.center_ = new google.maps.LatLng(lat, lng);\r\n      this.calculateBounds_();\r\n    }\r\n  }\r\n\r\n  marker.isAdded = true;\r\n  this.markers_.push(marker);\r\n\r\n  var len = this.markers_.length;\r\n  if (len < this.minClusterSize_ && marker.getMap() != this.map_) {\r\n    // Min cluster size not reached so show the marker.\r\n    marker.setMap(this.map_);\r\n  }\r\n\r\n  if (len == this.minClusterSize_) {\r\n    // Hide the markers that were showing.\r\n    for (var i = 0; i < len; i++) {\r\n      this.markers_[i].setMap(null);\r\n    }\r\n  }\r\n\r\n  if (len >= this.minClusterSize_) {\r\n    marker.setMap(null);\r\n  }\r\n\r\n  this.updateIcon();\r\n  return true;\r\n};\r\n\r\n\r\n/**\r\n * Returns the marker clusterer that the cluster is associated with.\r\n *\r\n * @return {MarkerClusterer} The associated marker clusterer.\r\n */\r\nCluster.prototype.getMarkerClusterer = function() {\r\n  return this.markerClusterer_;\r\n};\r\n\r\n\r\n/**\r\n * Returns the bounds of the cluster.\r\n *\r\n * @return {google.maps.LatLngBounds} the cluster bounds.\r\n */\r\nCluster.prototype.getBounds = function() {\r\n  var bounds = new google.maps.LatLngBounds(this.center_, this.center_);\r\n  var markers = this.getMarkers();\r\n  for (var i = 0, marker; marker = markers[i]; i++) {\r\n    bounds.extend(marker.getPosition());\r\n  }\r\n  return bounds;\r\n};\r\n\r\n\r\n/**\r\n * Removes the cluster\r\n */\r\nCluster.prototype.remove = function() {\r\n  this.clusterIcon_.remove();\r\n  this.markers_.length = 0;\r\n  delete this.markers_;\r\n};\r\n\r\n\r\n/**\r\n * Returns the center of the cluster.\r\n *\r\n * @return {number} The cluster center.\r\n */\r\nCluster.prototype.getSize = function() {\r\n  return this.markers_.length;\r\n};\r\n\r\n\r\n/**\r\n * Returns the center of the cluster.\r\n *\r\n * @return {Array.<google.maps.Marker>} The cluster center.\r\n */\r\nCluster.prototype.getMarkers = function() {\r\n  return this.markers_;\r\n};\r\n\r\n\r\n/**\r\n * Returns the center of the cluster.\r\n *\r\n * @return {google.maps.LatLng} The cluster center.\r\n */\r\nCluster.prototype.getCenter = function() {\r\n  return this.center_;\r\n};\r\n\r\n\r\n/**\r\n * Calculated the extended bounds of the cluster with the grid.\r\n *\r\n * @private\r\n */\r\nCluster.prototype.calculateBounds_ = function() {\r\n  var bounds = new google.maps.LatLngBounds(this.center_, this.center_);\r\n  this.bounds_ = this.markerClusterer_.getExtendedBounds(bounds);\r\n};\r\n\r\n\r\n/**\r\n * Determines if a marker lies in the clusters bounds.\r\n *\r\n * @param {google.maps.Marker} marker The marker to check.\r\n * @return {boolean} True if the marker lies in the bounds.\r\n */\r\nCluster.prototype.isMarkerInClusterBounds = function(marker) {\r\n  return this.bounds_.contains(marker.getPosition());\r\n};\r\n\r\n\r\n/**\r\n * Returns the map that the cluster is associated with.\r\n *\r\n * @return {google.maps.Map} The map.\r\n */\r\nCluster.prototype.getMap = function() {\r\n  return this.map_;\r\n};\r\n\r\n\r\n/**\r\n * Updates the cluster icon\r\n */\r\nCluster.prototype.updateIcon = function() {\r\n  var zoom = this.map_.getZoom();\r\n  var mz = this.markerClusterer_.getMaxZoom();\r\n\r\n  if (mz && zoom > mz) {\r\n    // The zoom is greater than our max zoom so show all the markers in cluster.\r\n    for (var i = 0, marker; marker = this.markers_[i]; i++) {\r\n      marker.setMap(this.map_);\r\n    }\r\n    return;\r\n  }\r\n\r\n  if (this.markers_.length < this.minClusterSize_) {\r\n    // Min cluster size not yet reached.\r\n    this.clusterIcon_.hide();\r\n    return;\r\n  }\r\n\r\n  var numStyles = this.markerClusterer_.getStyles().length;\r\n  var sums = this.markerClusterer_.getCalculator()(this.markers_, numStyles);\r\n  this.clusterIcon_.setCenter(this.center_);\r\n  this.clusterIcon_.setSums(sums);\r\n  this.clusterIcon_.show();\r\n};\r\n\r\n\r\n/**\r\n * A cluster icon\r\n *\r\n * @param {Cluster} cluster The cluster to be associated with.\r\n * @param {Object} styles An object that has style properties:\r\n *     'url': (string) The image url.\r\n *     'height': (number) The image height.\r\n *     'width': (number) The image width.\r\n *     'anchor': (Array) The anchor position of the label text.\r\n *     'textColor': (string) The text color.\r\n *     'textSize': (number) The text size.\r\n *     'backgroundPosition: (string) The background postition x, y.\r\n * @param {number=} opt_padding Optional padding to apply to the cluster icon.\r\n * @constructor\r\n * @extends google.maps.OverlayView\r\n * @ignore\r\n */\r\nfunction ClusterIcon(cluster, styles, opt_padding) {\r\n  cluster.getMarkerClusterer().extend(ClusterIcon, google.maps.OverlayView);\r\n\r\n  this.styles_ = styles;\r\n  this.padding_ = opt_padding || 0;\r\n  this.cluster_ = cluster;\r\n  this.center_ = null;\r\n  this.map_ = cluster.getMap();\r\n  this.div_ = null;\r\n  this.sums_ = null;\r\n  this.visible_ = false;\r\n\r\n  this.setMap(this.map_);\r\n}\r\n\r\n\r\n/**\r\n * Triggers the clusterclick event and zoom's if the option is set.\r\n *\r\n * @param {google.maps.MouseEvent} event The event to propagate\r\n */\r\nClusterIcon.prototype.triggerClusterClick = function(event) {\r\n  var markerClusterer = this.cluster_.getMarkerClusterer();\r\n\r\n  // Trigger the clusterclick event.\r\n  google.maps.event.trigger(markerClusterer, 'clusterclick', this.cluster_, event);\r\n\r\n  if (markerClusterer.isZoomOnClick()) {\r\n    // Zoom into the cluster.\r\n    this.map_.fitBounds(this.cluster_.getBounds());\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Adding the cluster icon to the dom.\r\n * @ignore\r\n */\r\nClusterIcon.prototype.onAdd = function() {\r\n  this.div_ = document.createElement('DIV');\r\n  this.div_.className='cluster';\r\n\r\n  if (this.visible_) {\r\n    var pos = this.getPosFromLatLng_(this.center_);\r\n    this.div_.style.cssText = this.createCss(pos);\r\n    this.div_.innerHTML = this.sums_.text;\r\n    this.div_.className='cluster-visible';\r\n  }\r\n\r\n  var panes = this.getPanes();\r\n  panes.overlayMouseTarget.appendChild(this.div_);\r\n\r\n  var that = this;\r\n  var isDragging = false;\r\n  google.maps.event.addDomListener(this.div_, 'click', function(event) {\r\n    // Only perform click when not preceded by a drag\r\n    if (!isDragging) {\r\n      that.triggerClusterClick(event);\r\n    }\r\n  });\r\n  google.maps.event.addDomListener(this.div_, 'mousedown', function() {\r\n    isDragging = false;\r\n  });\r\n  google.maps.event.addDomListener(this.div_, 'mousemove', function() {\r\n    isDragging = true;\r\n  });\r\n};\r\n\r\n\r\n/**\r\n * Returns the position to place the div dending on the latlng.\r\n *\r\n * @param {google.maps.LatLng} latlng The position in latlng.\r\n * @return {google.maps.Point} The position in pixels.\r\n * @private\r\n */\r\nClusterIcon.prototype.getPosFromLatLng_ = function(latlng) {\r\n  var pos = this.getProjection().fromLatLngToDivPixel(latlng);\r\n\r\n  if (typeof this.iconAnchor_ === 'object' && this.iconAnchor_.length === 2) {\r\n    pos.x -= this.iconAnchor_[0];\r\n    pos.y -= this.iconAnchor_[1];\r\n  } else {\r\n    pos.x -= parseInt(this.width_ / 2, 10);\r\n    pos.y -= parseInt(this.height_ / 2, 10);\r\n  }\r\n  return pos;\r\n};\r\n\r\n\r\n/**\r\n * Draw the icon.\r\n * @ignore\r\n */\r\nClusterIcon.prototype.draw = function() {\r\n  if (this.visible_) {\r\n    var pos = this.getPosFromLatLng_(this.center_);\r\n    this.div_.style.top = pos.y + 'px';\r\n    this.div_.style.left = pos.x + 'px';\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Hide the icon.\r\n */\r\nClusterIcon.prototype.hide = function() {\r\n  if (this.div_) {\r\n    this.div_.style.display = 'none';\r\n  }\r\n  this.visible_ = false;\r\n};\r\n\r\n\r\n/**\r\n * Position and show the icon.\r\n */\r\nClusterIcon.prototype.show = function() {\r\n  if (this.div_) {\r\n    var pos = this.getPosFromLatLng_(this.center_);\r\n    this.div_.style.cssText = this.createCss(pos);\r\n    this.div_.style.display = '';\r\n  }\r\n  this.visible_ = true;\r\n};\r\n\r\n\r\n/**\r\n * Remove the icon from the map\r\n */\r\nClusterIcon.prototype.remove = function() {\r\n  this.setMap(null);\r\n};\r\n\r\n\r\n/**\r\n * Implementation of the onRemove interface.\r\n * @ignore\r\n */\r\nClusterIcon.prototype.onRemove = function() {\r\n  if (this.div_ && this.div_.parentNode) {\r\n    this.hide();\r\n    this.div_.parentNode.removeChild(this.div_);\r\n    this.div_ = null;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Set the sums of the icon.\r\n *\r\n * @param {Object} sums The sums containing:\r\n *   'text': (string) The text to display in the icon.\r\n *   'index': (number) The style index of the icon.\r\n */\r\nClusterIcon.prototype.setSums = function(sums) {\r\n  this.sums_ = sums;\r\n  this.text_ = sums.text;\r\n  this.index_ = sums.index;\r\n  if (this.div_) {\r\n    this.div_.innerHTML = sums.text;\r\n  }\r\n\r\n  this.useStyle();\r\n};\r\n\r\n\r\n/**\r\n * Sets the icon to the the styles.\r\n */\r\nClusterIcon.prototype.useStyle = function() {\r\n  var index = Math.max(0, this.sums_.index - 1);\r\n  index = Math.min(this.styles_.length - 1, index);\r\n  var style = this.styles_[index];\r\n  this.url_ = style['url'];\r\n  this.height_ = style['height'];\r\n  this.width_ = style['width'];\r\n  this.textColor_ = style['textColor'];\r\n  this.anchor_ = style['anchor'];\r\n  this.textSize_ = style['textSize'];\r\n  this.backgroundPosition_ = style['backgroundPosition'];\r\n  this.iconAnchor_ = style['iconAnchor'];\r\n};\r\n\r\n\r\n/**\r\n * Sets the center of the icon.\r\n *\r\n * @param {google.maps.LatLng} center The latlng to set as the center.\r\n */\r\nClusterIcon.prototype.setCenter = function(center) {\r\n  this.center_ = center;\r\n};\r\n\r\n\r\n/**\r\n * Create the css text based on the position of the icon.\r\n *\r\n * @param {google.maps.Point} pos The position.\r\n * @return {string} The css style text.\r\n */\r\nClusterIcon.prototype.createCss = function(pos) {\r\n  var style = [];\r\n  style.push('background-image:url(' + this.url_ + ');');\r\n  var backgroundPosition = this.backgroundPosition_ ? this.backgroundPosition_ : '0 0';\r\n  style.push('background-position:' + backgroundPosition + ';');\r\n\r\n  if (typeof this.anchor_ === 'object') {\r\n    if (typeof this.anchor_[0] === 'number' && this.anchor_[0] > 0 &&\r\n        this.anchor_[0] < this.height_) {\r\n      style.push('height:' + (this.height_ - this.anchor_[0]) +\r\n          'px; padding-top:' + this.anchor_[0] + 'px;');\r\n    } else if (typeof this.anchor_[0] === 'number' && this.anchor_[0] < 0 &&\r\n        -this.anchor_[0] < this.height_) {\r\n      style.push('height:' + this.height_ + 'px; line-height:' + (this.height_ + this.anchor_[0]) +\r\n          'px;');\r\n    } else {\r\n      style.push('height:' + this.height_ + 'px; line-height:' + this.height_ +\r\n          'px;');\r\n    }\r\n    if (typeof this.anchor_[1] === 'number' && this.anchor_[1] > 0 &&\r\n        this.anchor_[1] < this.width_) {\r\n      style.push('width:' + (this.width_ - this.anchor_[1]) +\r\n          'px; padding-left:' + this.anchor_[1] + 'px;');\r\n    } else {\r\n      style.push('width:' + this.width_ + 'px; text-align:center;');\r\n    }\r\n  } else {\r\n    style.push('height:' + this.height_ + 'px; line-height:' +\r\n        this.height_ + 'px; width:' + this.width_ + 'px; text-align:center;');\r\n  }\r\n\r\n  var txtColor = this.textColor_ ? this.textColor_ : 'black';\r\n  var txtSize = this.textSize_ ? this.textSize_ : 11;\r\n\r\n  style.push('cursor:pointer; top:' + pos.y + 'px; left:' +\r\n      pos.x + 'px; color:' + txtColor + '; position:absolute; font-size:' +\r\n      txtSize + 'px; font-family:Arial,sans-serif; font-weight:bold');\r\n  return style.join('');\r\n};\r\n\r\n\r\n// Export Symbols for Closure\r\n// If you are not going to compile with closure then you can remove the\r\n// code below.\r\nwindow['MarkerClusterer'] = MarkerClusterer;\r\nMarkerClusterer.prototype['addMarker'] = MarkerClusterer.prototype.addMarker;\r\nMarkerClusterer.prototype['addMarkers'] = MarkerClusterer.prototype.addMarkers;\r\nMarkerClusterer.prototype['clearMarkers'] =\r\n    MarkerClusterer.prototype.clearMarkers;\r\nMarkerClusterer.prototype['fitMapToMarkers'] =\r\n    MarkerClusterer.prototype.fitMapToMarkers;\r\nMarkerClusterer.prototype['getCalculator'] =\r\n    MarkerClusterer.prototype.getCalculator;\r\nMarkerClusterer.prototype['getGridSize'] =\r\n    MarkerClusterer.prototype.getGridSize;\r\nMarkerClusterer.prototype['getExtendedBounds'] =\r\n    MarkerClusterer.prototype.getExtendedBounds;\r\nMarkerClusterer.prototype['getMap'] = MarkerClusterer.prototype.getMap;\r\nMarkerClusterer.prototype['getMarkers'] = MarkerClusterer.prototype.getMarkers;\r\nMarkerClusterer.prototype['getMaxZoom'] = MarkerClusterer.prototype.getMaxZoom;\r\nMarkerClusterer.prototype['getStyles'] = MarkerClusterer.prototype.getStyles;\r\nMarkerClusterer.prototype['getTotalClusters'] =\r\n    MarkerClusterer.prototype.getTotalClusters;\r\nMarkerClusterer.prototype['getTotalMarkers'] =\r\n    MarkerClusterer.prototype.getTotalMarkers;\r\nMarkerClusterer.prototype['redraw'] = MarkerClusterer.prototype.redraw;\r\nMarkerClusterer.prototype['removeMarker'] =\r\n    MarkerClusterer.prototype.removeMarker;\r\nMarkerClusterer.prototype['removeMarkers'] =\r\n    MarkerClusterer.prototype.removeMarkers;\r\nMarkerClusterer.prototype['resetViewport'] =\r\n    MarkerClusterer.prototype.resetViewport;\r\nMarkerClusterer.prototype['repaint'] =\r\n    MarkerClusterer.prototype.repaint;\r\nMarkerClusterer.prototype['setCalculator'] =\r\n    MarkerClusterer.prototype.setCalculator;\r\nMarkerClusterer.prototype['setGridSize'] =\r\n    MarkerClusterer.prototype.setGridSize;\r\nMarkerClusterer.prototype['setMaxZoom'] =\r\n    MarkerClusterer.prototype.setMaxZoom;\r\nMarkerClusterer.prototype['onAdd'] = MarkerClusterer.prototype.onAdd;\r\nMarkerClusterer.prototype['draw'] = MarkerClusterer.prototype.draw;\r\n\r\nCluster.prototype['getCenter'] = Cluster.prototype.getCenter;\r\nCluster.prototype['getSize'] = Cluster.prototype.getSize;\r\nCluster.prototype['getMarkers'] = Cluster.prototype.getMarkers;\r\n\r\nClusterIcon.prototype['onAdd'] = ClusterIcon.prototype.onAdd;\r\nClusterIcon.prototype['draw'] = ClusterIcon.prototype.draw;\r\nClusterIcon.prototype['onRemove'] = ClusterIcon.prototype.onRemove;\r\n"]}